import { createRequire as __createRequire } from 'module';
import { fileURLToPath as __fileURLToPath } from 'url';
import path from 'path';
const require = __createRequire(import.meta.url);
const __filename = __fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
globalThis.__filename = globalThis.__filename || __filename;
globalThis.__dirname = globalThis.__dirname || __dirname;
var Bt=Object.create;var Be=Object.defineProperty;var $t=Object.getOwnPropertyDescriptor;var Pt=Object.getOwnPropertyNames;var zt=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty;var le=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var $e=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ut=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Pt(t))!Ft.call(e,r)&&r!==n&&Be(e,r,{get:()=>t[r],enumerable:!(s=$t(t,r))||s.enumerable});return e};var Vt=(e,t,n)=>(n=e!=null?Bt(zt(e)):{},Ut(t||!e||!e.__esModule?Be(n,"default",{value:e,enumerable:!0}):n,e));var Pe=$e((or,Kt)=>{Kt.exports={name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var Ke=$e((ir,$)=>{var we=le("fs"),ue=le("path"),Ht=le("os"),qt=le("crypto"),Wt=Pe(),Ee=Wt.version,Yt=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function Jt(e){let t={},n=e.toString();n=n.replace(/\r\n?/mg,`
`);let s;for(;(s=Yt.exec(n))!=null;){let r=s[1],o=s[2]||"";o=o.trim();let i=o[0];o=o.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),i==='"'&&(o=o.replace(/\\n/g,`
`),o=o.replace(/\\r/g,"\r")),t[r]=o}return t}function Gt(e){e=e||{};let t=Ve(e);e.path=t;let n=C.configDotenv(e);if(!n.parsed){let i=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw i.code="MISSING_DATA",i}let s=Ue(e).split(","),r=s.length,o;for(let i=0;i<r;i++)try{let a=s[i].trim(),c=Xt(n,a);o=C.decrypt(c.ciphertext,c.key);break}catch(a){if(i+1>=r)throw a}return C.parse(o)}function Qt(e){console.log(`[dotenv@${Ee}][WARN] ${e}`)}function ne(e){console.log(`[dotenv@${Ee}][DEBUG] ${e}`)}function Fe(e){console.log(`[dotenv@${Ee}] ${e}`)}function Ue(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function Xt(e,t){let n;try{n=new URL(t)}catch(a){if(a.code==="ERR_INVALID_URL"){let c=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw c.code="INVALID_DOTENV_KEY",c}throw a}let s=n.password;if(!s){let a=new Error("INVALID_DOTENV_KEY: Missing key part");throw a.code="INVALID_DOTENV_KEY",a}let r=n.searchParams.get("environment");if(!r){let a=new Error("INVALID_DOTENV_KEY: Missing environment part");throw a.code="INVALID_DOTENV_KEY",a}let o=`DOTENV_VAULT_${r.toUpperCase()}`,i=e.parsed[o];if(!i){let a=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${o} in your .env.vault file.`);throw a.code="NOT_FOUND_DOTENV_ENVIRONMENT",a}return{ciphertext:i,key:s}}function Ve(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(let n of e.path)we.existsSync(n)&&(t=n.endsWith(".vault")?n:`${n}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=ue.resolve(process.cwd(),".env.vault");return we.existsSync(t)?t:null}function ze(e){return e[0]==="~"?ue.join(Ht.homedir(),e.slice(1)):e}function Zt(e){let t=!!(e&&e.debug),n=e&&"quiet"in e?e.quiet:!0;(t||!n)&&Fe("Loading env from encrypted .env.vault");let s=C._parseVault(e),r=process.env;return e&&e.processEnv!=null&&(r=e.processEnv),C.populate(r,s,e),{parsed:s}}function en(e){let t=ue.resolve(process.cwd(),".env"),n="utf8",s=!!(e&&e.debug),r=e&&"quiet"in e?e.quiet:!0;e&&e.encoding?n=e.encoding:s&&ne("No encoding is specified. UTF-8 is used by default");let o=[t];if(e&&e.path)if(!Array.isArray(e.path))o=[ze(e.path)];else{o=[];for(let u of e.path)o.push(ze(u))}let i,a={};for(let u of o)try{let l=C.parse(we.readFileSync(u,{encoding:n}));C.populate(a,l,e)}catch(l){s&&ne(`Failed to load ${u} ${l.message}`),i=l}let c=process.env;if(e&&e.processEnv!=null&&(c=e.processEnv),C.populate(c,a,e),s||!r){let u=Object.keys(a).length,l=[];for(let f of o)try{let d=ue.relative(process.cwd(),f);l.push(d)}catch(d){s&&ne(`Failed to load ${f} ${d.message}`),i=d}Fe(`injecting env (${u}) from ${l.join(",")}`)}return i?{parsed:a,error:i}:{parsed:a}}function tn(e){if(Ue(e).length===0)return C.configDotenv(e);let t=Ve(e);return t?C._configVault(e):(Qt(`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`),C.configDotenv(e))}function nn(e,t){let n=Buffer.from(t.slice(-64),"hex"),s=Buffer.from(e,"base64"),r=s.subarray(0,12),o=s.subarray(-16);s=s.subarray(12,-16);try{let i=qt.createDecipheriv("aes-256-gcm",n,r);return i.setAuthTag(o),`${i.update(s)}${i.final()}`}catch(i){let a=i instanceof RangeError,c=i.message==="Invalid key length",u=i.message==="Unsupported state or unable to authenticate data";if(a||c){let l=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw l.code="INVALID_DOTENV_KEY",l}else if(u){let l=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw l.code="DECRYPTION_FAILED",l}else throw i}}function sn(e,t,n={}){let s=!!(n&&n.debug),r=!!(n&&n.override);if(typeof t!="object"){let o=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw o.code="OBJECT_REQUIRED",o}for(let o of Object.keys(t))Object.prototype.hasOwnProperty.call(e,o)?(r===!0&&(e[o]=t[o]),s&&ne(r===!0?`"${o}" is already defined and WAS overwritten`:`"${o}" is already defined and was NOT overwritten`)):e[o]=t[o]}var C={configDotenv:en,_configVault:Zt,_parseVault:Gt,config:tn,decrypt:nn,parse:Jt,populate:sn};$.exports.configDotenv=C.configDotenv;$.exports._configVault=C._configVault;$.exports._parseVault=C._parseVault;$.exports.config=C.config;$.exports.decrypt=C.decrypt;$.exports.parse=C.parse;$.exports.populate=C.populate;$.exports=C});var Je=Vt(Ke(),1);import ln from"fs";import un from"path";import k from"process";import v from"node:process";function A(e){return typeof e=="string"&&e.trim().length>0}function U(e){return typeof e=="string"?e.trim():""}var He=new Map(Object.entries({development:"dev",dev:"dev",production:"prod",prod:"prod",staging:"stage",stage:"stage",testing:"test",test:"test"}));function se(e){let t=U(e).toLowerCase();return t?He.has(t)?He.get(t):t:""}function rn(){let e=U(v.env.NODE_ENV);return se(e)}function qe(){if(A(v.env.STAGE_NAME)){let t=se(v.env.STAGE_NAME);if(t)return t}if(A(v.env.DEPLOYMENT_ENVIRONMENT)){let t=se(v.env.DEPLOYMENT_ENVIRONMENT);if(t)return t}let e=rn();return e||"dev"}function on({stageName:e}={}){if(A(v.env.DEPLOYMENT_ENVIRONMENT)){let n=se(v.env.DEPLOYMENT_ENVIRONMENT);if(n)return n}let t=A(e)?se(e):qe();return t||"dev"}function We(){return A(v.env.DATA_BUCKET)?U(v.env.DATA_BUCKET):A(v.env.S3_BUCKET)?U(v.env.S3_BUCKET):""}function an({dataBucket:e}={}){if(A(v.env.STATIC_ASSETS_BUCKET))return U(v.env.STATIC_ASSETS_BUCKET);if(A(e))return U(e);let t=We();return t||""}function cn(){return A(v.env.LOGS_BUCKET)?U(v.env.LOGS_BUCKET):""}function L(e,t){typeof e=="string"&&A(t)&&(v.env[e]=U(t))}function Ye({propagateToProcessEnv:e=!0,propagateViteEnv:t=!1}={}){let n=qe(),s=on({stageName:n}),r=We(),o=an({dataBucket:r}),i=cn();return e&&(L("STAGE_NAME",n),L("DEPLOYMENT_ENVIRONMENT",s),A(r)&&L("S3_BUCKET",r),A(o)&&L("STATIC_ASSETS_BUCKET",o),A(i)&&L("LOGS_BUCKET",i)),t&&(L("VITE_STAGE_NAME",n),L("VITE_DEPLOYMENT_ENVIRONMENT",s),A(r)&&(L("VITE_S3_BUCKET",r),L("VITE_DATA_BUCKET",r)),A(o)&&L("VITE_STATIC_ASSETS_BUCKET",o),A(i)&&L("VITE_LOGS_BUCKET",i)),{stageName:n,deploymentEnvironment:s,dataBucket:r,staticAssetsBucket:o,logsBucket:i}}function K(e){return typeof e=="string"&&e.trim().length>0}var fn=K(k.env.NODE_ENV)?k.env.NODE_ENV.trim().toLowerCase():"development",dn=!!k.env.AWS_LAMBDA_FUNCTION_NAME,mn=!dn&&(fn==="development"||!K(k.env.NODE_ENV));if(mn){let e=un.resolve(k.cwd(),".env");ln.existsSync(e)&&Je.default.config({path:e})}var Ge=["S3_BUCKET","GEMINI_API_KEY"],pn=["CLOUDFRONT_ORIGINS"],Te=Ge.filter(e=>!K(k.env[e]));pn.forEach(e=>{K(k.env[e])||console.warn(`Optional environment value ${e} is not set. Provide it via the runtime config file or environment to enable strict CORS.`)});!K(k.env.AWS_REGION)&&K(k.env.AWS_DEFAULT_REGION)&&(k.env.AWS_REGION=k.env.AWS_DEFAULT_REGION.trim());K(k.env.AWS_REGION)||Te.push("AWS_REGION");if(Te.length>0)throw new Error(`Missing required environment variables: ${Te.join(", ")}. Ensure they are configured via deployment secrets or a local .env file.`);var{stageName:mr,deploymentEnvironment:gn}=Ye({propagateToProcessEnv:!0,propagateViteEnv:!1});function hn(e){let t=new URLSearchParams(e||"");return t.set("environment",gn),t.toString()}function re(e={}){return{...e,Tagging:hn(e.Tagging)}}var pr=Object.freeze([...Ge,"AWS_REGION"]);import{PutObjectCommand as Qn,S3Client as Xn}from"@aws-sdk/client-s3";import P from"node:process";var fe=null;function Qe(e=[]){for(let t of e)if(typeof t=="string"){let n=t.trim();if(n)return n}return null}function yn(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()}function bn(){let e=[P.env.BUILD_TIMESTAMP,P.env.DEPLOY_TIMESTAMP];for(let t of e){let n=yn(t);if(n)return n}return new Date().toISOString()}function Sn(){if(fe)return fe;let e=Qe([P.env.BUILD_VERSION,P.env.VERSION,P.env.npm_package_version]),t=Qe([P.env.BUILD_SHA,P.env.GIT_COMMIT,P.env.GIT_SHA,P.env.GITHUB_SHA]),n=bn();return fe={version:e||null,sha:t||null,timestamp:n},fe}function Ce(e,{fallback:t="unknown"}={}){return typeof e=="string"&&e.trim()?e.trim():typeof e=="number"&&Number.isFinite(e)?String(e):t}function Xe({versionLabel:e}={}){let{version:t,sha:n,timestamp:s}=Sn(),r={"build-timestamp":Ce(s,{fallback:new Date().toISOString()}),"build-version":Ce(t||e),"build-sha":Ce(n)};return typeof e=="string"&&e.trim()&&(r["asset-version-label"]=e.trim()),r}function wn(e={}){let t=Xe(e),n=typeof t["build-sha"]=="string"?t["build-sha"].trim():"",s=typeof t["build-timestamp"]=="string"?t["build-timestamp"].trim():"",r=[];return n&&r.push({Key:"build",Value:n}),s&&r.push({Key:"deployed",Value:s}),r}function En(e,t=[]){let n=new URLSearchParams(e||"");for(let s of t){if(!s||typeof s.Key!="string")continue;let r=s.Key.trim();if(!r)continue;let o=typeof s.Value=="string"?s.Value.trim():"";o&&n.set(r,o)}return n.toString()}function oe(e={},t={}){let n=Xe(t),s=e&&typeof e=="object"&&typeof e.Metadata=="object"&&e.Metadata!==null&&!Array.isArray(e.Metadata)?e.Metadata:{},r=En(e?.Tagging,wn(t)),o={...e,Metadata:{...s,...n}};return r&&(o.Tagging=r),o}function Ze(e={}){if(!e||typeof e.body>"u"||e.body===null)return{};if(typeof e.body=="object")return e.body;try{let t=e.isBase64Encoded?Buffer.from(e.body,"base64").toString("utf8"):e.body;return JSON.parse(t)}catch{return{}}}var Tn=new Set("a,an,and,are,as,at,be,by,for,from,has,have,in,is,it,of,on,or,that,the,to,with,will,our,your,they,them,into,about,over,more,than,who,what,when,where,which,were,while,within,under,across,through,using,per".split(",").map(e=>e.trim())),de=[{key:"layoutSearchability",category:"Layout & Searchability"},{key:"atsReadability",category:"Readability"},{key:"impact",category:"Impact"},{key:"crispness",category:"Crispness"},{key:"otherQuality",category:"Other"}],Cn={layoutSearchability:.2,atsReadability:.25,impact:.25,crispness:.15,otherQuality:.15};function et(e){return e>=85?"EXCELLENT":e>=70?"GOOD":"NEEDS_IMPROVEMENT"}function q(e,t,n){return Math.min(Math.max(e,t),n)}function T(e){return q(e,0,1)}function J(e=[],{limit:t=3,conjunction:n="and"}={}){if(!e.length)return"";let s=Array.from(new Set(e)).filter(Boolean);if(!s.length)return"";if(s.length===1)return s[0];if(s.length===2)return`${s[0]} ${n} ${s[1]}`;let r=s.slice(0,t),o=s.length-r.length;if(o>0)return`${r.join(", ")} and ${o} more`;let i=r.slice(0,-1).join(", "),a=r.slice(-1);return i?`${i} ${n} ${a}`:a.join("")}function H(e,t,n=[],s={}){let r=q(t,0,100),o=Math.round(r),i=et(o),a=Array.from(new Set((n||[]).map(u=>typeof u=="string"?u.trim():"").filter(Boolean))),c=s&&typeof s=="object"?s.details:void 0;return a.length||(i==="EXCELLENT"?a.push(`Keep refining your ${e.toLowerCase()} as you add new achievements so the resume stays future-proof.`):a.push(`Focus on improving ${e.toLowerCase()} to raise this score\u2014tighten structure and mirror the job requirements.`)),{category:e,score:o,rating:i,ratingLabel:i,tips:a,...c?{details:c}:{}}}function Nn(e,{ideal:t=.4,tolerance:n=.25}={}){if(!isFinite(e)||e<=0)return 0;let s=Math.abs(e-t);return T(1-s/n)}function An(e,{idealMin:t=0,idealMax:n=1,tolerance:s=(n-t)/2}={}){if(!isFinite(e)||e<=0)return 0;if(e>=t&&e<=n)return 1;let r=e<t?t-e:e-n;return s<=0?0:T(1-r/s)}function vn(e,t){if(!e||typeof e!="object")return H(t,0);let n=typeof e.score=="number"?q(e.score,0,100):0,s=Math.round(n),r=et(s),o=Array.from(new Set([].concat(typeof e.tip=="string"?e.tip:[]).concat(Array.isArray(e.tips)?e.tips:[]).map(a=>typeof a=="string"?a.trim():"").filter(Boolean))),i=H(t,s,o).tips;return{...e,category:e.category||t,score:s,rating:r,ratingLabel:r,tips:o.length?o:i}}function G(e={}){return de.reduce((t,{key:n,category:s})=>{let r=vn(e[n],s);return{...t,[n]:r}},{})}function Ne(e={}){let t=G(e),n=0,s=0;return de.forEach(({key:r})=>{let o=Cn[r]??1,i=typeof t[r]?.score=="number"&&Number.isFinite(t[r].score)?q(t[r].score,0,100):0;n+=i*o,s+=o}),s?Math.round(n/s):0}var tt=["accelerated","achieved","built","delivered","developed","drove","enhanced","expanded","improved","increased","launched","led","optimized","reduced","scaled","spearheaded","streamlined"];function Y(e=""){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function In(e=""){if(!e)return"";let t=e.split(/\r?\n/),n=/^[A-Z][A-Z0-9\s/&-]{2,}$/,s=/^(summary|professional summary|profile|overview)$/i,r=!1,o=[];for(let i=0;i<t.length;i+=1){let c=t[i].trim();if(!r){c&&s.test(c)&&(r=!0);continue}if(!c){o.push("");continue}if(n.test(c)&&c===c.toUpperCase()||/^(experience|work experience|employment history|education|skills|projects|certifications|awards|accomplishments)$/i.test(c))break;o.push(c.replace(/\s+/g," "))}return o.join(" ").replace(/\s+/g," ").trim()}function Rn(e="",{jobText:t="",jobSkills:n=[],resumeSkills:s=[]}={}){let r=e.toLowerCase(),o=(t||"").toLowerCase(),i=e.split(/\r?\n/),a=i.map(y=>y.trim()).filter(Boolean),c=e.split(/\n\s*\n/).map(y=>y.trim()).filter(Boolean),u=c.filter(y=>/^[-•\u2022\u2023\u25e6\*]/.test(y)?!1:y.split(/\s+/).filter(Boolean).length>=70),l=a.filter(y=>/^[-•\u2022\u2023\u25e6\*]/.test(y)),f=a.filter(y=>y.length>42?!1:y.replace(/[^A-Za-z]/g,"").toUpperCase().length>=4&&y===y.toUpperCase()),d=new Set(f.map(y=>y.replace(/[^a-z]/gi,"").toLowerCase())),g=a.filter(y=>y.split(/\s{3,}/).length>=2),S=a.length?l.length/a.length:0,h=l.map(y=>y.replace(/^[-•\u2022\u2023\u25e6\*]\s*/,"").split(/\s+/).filter(Boolean).length),m=[],p=[];l.forEach((y,R)=>{let te=h[R]||0;te>28&&m.push(y),te>0&&te<8&&p.push(y)});let b=h.length?h.reduce((y,R)=>y+R,0)/h.length:0,_=l.filter(y=>/\b(responsible for|duties included|tasked with)\b/i.test(y)),w=l.filter(y=>tt.some(R=>new RegExp(`\\b${Y(R)}\\b`,"i").test(y))||/[+\d%$]/.test(y)),E=new Set((n||[]).map(y=>y.toLowerCase()).filter(Boolean)),O=new Set((s||[]).map(y=>y.toLowerCase()).filter(Boolean)),x=(o.match(/[a-z0-9+.#]+/g)||[]).filter(y=>y.length>=4&&!Tn.has(y)).slice(0,80),V=new Set([...E,...x]),Z=Array.from(V),N=l.map(y=>{let R=Z.filter(te=>new RegExp(`\\b${Y(te)}\\b`,"i").test(y));return R.length?{line:y,matches:R}:null}).filter(Boolean),Se=N.map(y=>y.line),M=new Set(N.flatMap(y=>y.matches.map(R=>R.toLowerCase()))).size,vt=N.reduce((y,R)=>y+R.matches.length,0),It=V.size?T(M/Math.max(4,V.size)):0,Rt=M?(vt-M)/Math.max(1,M):0,xt=T(Rt/4),Mt=Z.filter(y=>new RegExp(`\\b${Y(y)}\\b`,"i").test(e)),ee=In(e),_t=ee?Z.filter(y=>new RegExp(`\\b${Y(y)}\\b`,"i").test(ee)):[],kt=ee?Array.from(E).filter(y=>new RegExp(`\\b${Y(y)}\\b`,"i").test(ee)):[],je=i.length,Dt=Math.max(1,Math.ceil(je/55)),Ot=(e.match(/[\u2460-\u24ff\u2500-\u257f]/g)||[]).length,Lt=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)||/\b\+?\d{1,3}[\s.-]?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}\b/.test(e),jt=Array.from(d).some(y=>/summary|profile|overview/.test(y));return{text:e,normalizedResume:r,normalizedJobText:o,lines:a,bulletLines:l,headingLines:f,headingSet:d,multiColumnIndicators:g,bulletRatio:S,bulletWordCounts:h,avgBulletWords:b,fillerBullets:_,paragraphs:c,denseParagraphs:u,achievementLines:w,longBulletLines:m,shortBulletLines:p,normalizedJobSkills:E,normalizedResumeSkills:O,jobKeywordSet:V,bulletKeywordUniqueCount:M,bulletKeywordVariety:It,bulletKeywordHits:Se,keywordStuffingPenalty:xt,jobKeywordMatches:Mt,summaryText:ee,summaryKeywordHits:_t,summarySkillHits:kt,nonAsciiCharacters:Ot,hasContactInfo:Lt,summaryPresent:jt,rawLineCount:je,estimatedPageCount:Dt}}function xn(e){let{headingLines:t,headingSet:n,bulletRatio:s,bulletLines:r,lines:o,hasContactInfo:i,denseParagraphs:a,estimatedPageCount:c,rawLineCount:u}=e,l=["experience","education","skills","summary"],f=l.filter(x=>Array.from(n).some(V=>V.includes(x))),d=T(t.length/6),g=T(f.length/l.length),S=r.length?Nn(s,{ideal:.42,tolerance:.28}):0,h=i?1:0,m=a.length?Math.min(.25,a.length*.08):0,p=c>2?Math.min(.3,(c-2)*.18):0,b=u>130?Math.min(.2,(u-130)*.003):0,_=100*T(d*.23+g*.24+S*.33+h*.14-m-p-b),w=l.filter(x=>!f.includes(x)).map(x=>x.charAt(0).toUpperCase()+x.slice(1)),E=[];w.length&&E.push(`Add clear section headers for ${J(w)} so ATS bots can index your resume (only ${t.length} heading${t.length===1?"":"s"} detected).`),r.length&&S<.55&&E.push(`Adjust your bullet usage\u2014${r.length} bullet${r.length===1?"":"s"} across ${o.length} lines makes scanning harder for recruiters.`),r.length||E.push("Break dense paragraphs into bullets so scanners can pick out wins."),i||E.push("Add contact details (email or phone) so hiring teams can reach you quickly."),a.length&&E.push(`Break up ${a.length} dense paragraph${a.length===1?"":"s"} with bullet points so resume scanners do not skip your achievements.`),c>2&&E.push(`Tighten the document to two pages\u2014ATS scoring drops once resumes stretch to ${c} pages.`),u>130&&c<=2&&E.push("Trim excess line spacing or sections so the resume stays within a quick-scan length."),E.length||E.push("Your structure is solid\u2014keep the consistent headings and bullet patterns to remain searchable.");let O={headingCount:t.length,headingDensity:Number((d*100).toFixed(1)),sectionCoverage:Number((g*100).toFixed(1)),bulletCount:r.length,bulletUsageScore:Number((S*100).toFixed(1)),contactInfoPresent:!!i,contactInfoScore:h?100:0,paragraphPenalty:Math.round(m*100),pagePenalty:Math.round(p*100),lengthPenalty:Math.round(b*100),estimatedPageCount:c,rawLineCount:u};return H("Layout & Searchability",_,E,{details:O})}function Mn(e){let{normalizedResume:t,text:n,multiColumnIndicators:s,nonAsciiCharacters:r}=e,o=[],i=/\btable\b/.test(t)&&/\|/.test(n),a=t.includes("table of contents"),c=/\bpage \d+ of \d+/i.test(n),u=/https?:\/\/\S+\.(png|jpg|jpeg|gif|svg)/i.test(n),l=/[{}<>]/.test(n),f={tableLikeFormatting:i?22:0,tableOfContents:a?18:0,pageNumberFooters:c?12:0,embeddedImages:u?16:0,multiColumnSpacing:s.length>0?Math.min(5+s.length*3,20):0,decorativeCharacters:l?8:0,nonAsciiCharacters:Math.min(r*1.5,18)},d=0;Object.entries(f).forEach(([m,p])=>{p>0&&(d+=p,m==="tableLikeFormatting"&&o.push("table-like formatting"),m==="tableOfContents"&&o.push("a table of contents"),m==="pageNumberFooters"&&o.push("page number footers"),m==="embeddedImages"&&o.push("embedded images"),m==="multiColumnSpacing"&&o.push("multi-column spacing that ATS bots misread"),m==="decorativeCharacters"&&o.push("decorative characters or HTML brackets"),m==="nonAsciiCharacters"&&r>0&&o.push("non-standard symbols that confuse parsers"))});let g=q(100-d,0,100),S=[];o.length?S.push(`Remove ${J(o)}\u2014they frequently break ATS parsing engines.`):S.push("Formatting is ATS-safe\u2014keep the clean structure as you update content."),s.length>=6&&S.push("Switch to a single-column layout so ATS parsers read left-to-right cleanly."),r>10&&S.push("Replace decorative symbols with plain text\u2014ATS parsers misread special characters.");let h={baseScore:100,penaltyTotal:Math.round(Math.min(d,100)),penaltyBreakdown:Object.fromEntries(Object.entries(f).map(([m,p])=>[m,Number(p.toFixed(2))])),multiColumnIndicators:s.length,nonAsciiCharacters:r};return H("Readability",g,S,{details:h})}function _n(e){let{achievementLines:t,bulletLines:n,bulletKeywordHits:s,bulletKeywordUniqueCount:r,bulletKeywordVariety:o,keywordStuffingPenalty:i,jobKeywordSet:a,summaryText:c,summaryKeywordHits:u,summarySkillHits:l,normalizedJobSkills:f,normalizedResumeSkills:d}=e,g=n.length,S=g?t.length/g:0,h=T(t.length/Math.max(3,g*.6)),m=n.length?s.length/n.length:0,p=o,b=1-Math.min(.6,i*.8),_=T((m*.6+p*.4)*b),w=!!c,E=w?T(l.length/Math.max(1,Math.min(f.size,6))):0,O=w?T((u.length+E*Math.min(a.size,6))/Math.max(2,Math.min(a.size,10))):0,x=a.size?a.size-(a.size-new Set(s).size):0,V=T(x/Math.max(4,a.size)),Z=100*T(S*.45+_*.22+h*.23+Math.max(O,E)*.1),N=[];if(t.length?t.length<Math.max(3,Math.ceil(n.length*.4))?N.push(`Strengthen impact statements by pairing more bullets with numbers\u2014only ${t.length} of ${n.length||"your"} bullet${t.length===1?"":"s"} include metrics or performance verbs.`):N.push("Your bullets already show strong impact\u2014keep pairing metrics with outcome-driven verbs."):N.push("Add metrics or outcome verbs (e.g., increased, reduced) to your bullets\u2014none of the bullet points currently show quantified results."),a.size>0){if(p<.3)N.push("Vary the job-aligned language\u2014repeating one keyword will not boost impact as much as weaving in a mix tied to wins.");else if(s.length<Math.max(2,Math.ceil(a.size*.1))){let F=Array.from(a).slice(0,5).map(M=>M.charAt(0).toUpperCase()+M.slice(1));F.length&&N.push(`Mirror the job posting by weaving in keywords such as ${J(F)} inside your accomplishment bullets.`)}}if(w&&l.length===0&&f.size>0&&N.push("Rework your summary to echo critical job keywords so reviewers immediately see the alignment."),i>=.4&&!N.some(F=>/vary/.test(F))&&N.push("Avoid keyword stuffing\u2014anchor achievements with varied, role-relevant language instead of repeating the same term."),d.size&&f.size){let F=Array.from(f).filter(M=>!d.has(M));F.length&&N.push(`Explicitly list ${J(F.map(M=>M.charAt(0).toUpperCase()+M.slice(1)),{limit:5})} to mirror the job posting.`)}N.length||N.push("Impact storytelling is strong\u2014keep quantifying wins as you add new roles.");let Se={bulletCount:g,achievementBullets:t.length,achievementRatio:Number((S*100).toFixed(1)),achievementVolumeScore:Number((h*100).toFixed(1)),keywordLineRatio:Number((m*100).toFixed(1)),keywordVariety:Number((p*100).toFixed(1)),keywordQualityScore:Number((_*100).toFixed(1)),keywordStuffingPenalty:Number((i*100).toFixed(1)),summaryPresent:w,summaryKeywordScore:Number((O*100).toFixed(1)),summarySkillScore:Number((E*100).toFixed(1)),jobKeywordCount:a.size,bulletKeywordHits:s.length,bulletKeywordUniqueCount:r};return H("Impact",Z,N,{details:Se})}function kn(e){let{bulletLines:t,avgBulletWords:n,fillerBullets:s,longBulletLines:r,shortBulletLines:o}=e,i=t.filter(p=>tt.some(b=>new RegExp(`^[-\u2022\u2022\u2023\u25E6*]?s*${Y(b)}\b`,"i").test(p))),a=An(n,{idealMin:12,idealMax:22,tolerance:10}),c=t.length?s.length/t.length:1,u=T(1-c),l=t.length?i.length/t.length:0,f=t.length?r.length/t.length:0,d=t.length?o.length/t.length:0,g=T(1-Math.min(1,f*1.1+Math.max(0,d-.3))),S=100*T(a*.3+u*.25+l*.25+g*.2),h=[];t.length||h.push("Introduce concise bullet points (12\u201320 words) so recruiters can skim quickly."),n&&n<12&&h.push(`Expand key bullets beyond ${Math.round(n)} words to explain scope and outcomes without losing clarity.`),n>22&&h.push(`Tighten lengthy bullets\u2014your average is ${Math.round(n)} words, above the ATS-friendly 18\u201322 word sweet spot.`),r.length&&h.push(`Break overly long bullets (${r.length}) into two lines so each accomplishment pops.`),o.length>Math.ceil(t.length*.4)&&h.push("Add a bit more context to ultra-short bullets so they explain the impact."),s.length&&h.push(`Replace filler openers like "responsible for" with action verbs\u2014${s.length} bullet${s.length===1?"":"s"} use passive phrasing.`),h.length||h.push("Bullet length is crisp and skimmable\u2014maintain this balance while adding fresh wins as needed.");let m={bulletCount:t.length,averageBulletWords:Number(n.toFixed(2)),lengthScore:Number((a*100).toFixed(1)),fillerBulletRatio:Number((c*100).toFixed(1)),fillerScore:Number((u*100).toFixed(1)),verbStartRatio:Number((l*100).toFixed(1)),balanceScore:Number((g*100).toFixed(1)),longBullets:r.length,shortBullets:o.length};return H("Crispness",S,h,{details:m})}function Dn(e){let{normalizedJobSkills:t,normalizedResumeSkills:n,jobKeywordMatches:s,bulletKeywordVariety:r,bulletKeywordUniqueCount:o,keywordStuffingPenalty:i,summaryPresent:a,summaryKeywordHits:c,summarySkillHits:u}=e,l=t.size?n.size/Math.max(t.size,1):n.size>0?1:0,f=s.length?s.length/Math.max(t.size||s.length,6):n.size?Math.min(1,n.size/12):0,d=r;d<=0&&(d=s.length?T(s.length/Math.max(t.size||s.length,8)):0);let g=a?.2:0,S=t.size?.45:.25,h=t.size?.35:.5,m=a?T((c.length+u.length)/Math.max(2,t.size)):0,p=1-Math.min(.5,i*.7),b=T((f*.6+d*.4)*p),_=100*T(l*S+b*h+m*g),w=[];if(n.size||w.push("Add a dedicated skills section so ATS parsers can map your proficiencies."),t.size&&n.size){let O=Array.from(t).filter(x=>!n.has(x));O.length&&w.push(`Incorporate keywords such as ${J(O)} to mirror the job description.`)}a&&!c.length&&t.size&&w.push(`Infuse your summary or headline with domain language from the posting\u2014for example ${J(Array.from(t).slice(0,3))}\u2014to reinforce alignment.`),i>=.4?w.push("Swap repeated keywords for specific accomplishments\u2014ATS now favors varied, evidence-backed language."):d<.3&&s.length&&w.push("Broaden the range of JD-aligned keywords instead of repeating the same few terms."),w.length||w.push("Keyword coverage is solid\u2014keep tailoring skills to each job description.");let E={normalizedJobSkillCount:t.size,normalizedResumeSkillCount:n.size,jobKeywordMatches:s.length,skillCoverage:Number((l*100).toFixed(1)),keywordCoverageScore:Number((f*100).toFixed(1)),keywordVariety:Number((d*100).toFixed(1)),keywordQualityComposite:Number((b*100).toFixed(1)),keywordStuffingPenalty:Number((i*100).toFixed(1)),summaryContribution:Number((m*100).toFixed(1)),weights:{skillWeight:Number((S*100).toFixed(1)),keywordWeight:Number((h*100).toFixed(1)),summaryWeight:Number((g*100).toFixed(1))},summaryPresent:a,bulletKeywordUniqueCount:o};return H("Other",_,w,{details:E})}function Ae(e="",{jobText:t="",jobSkills:n=[],resumeSkills:s=[]}={}){if(!e?.trim())return G();let r=Rn(e,{jobText:t,jobSkills:n,resumeSkills:s}),o=xn(r),i=Mn(r),a=_n(r),c=kn(r),u=Dn(r);return G({layoutSearchability:o,atsReadability:i,impact:a,crispness:c,otherQuality:u})}var On=["javascript","typescript","python","java","c++","c#","go","ruby","php","swift","kotlin","react","angular","vue","node","express","next.js","docker","kubernetes","aws","gcp","azure","sql","mysql","postgresql","mongodb","git","graphql","linux","bash","redis","jenkins","terraform","ansible"],Ln=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function ve(e=""){let t=e.toLowerCase(),n=[];for(let s of On)new RegExp(`\\b${Ln(s)}\\b`,"g").test(t)&&n.push(s);return n}function Ie(e=[],t=[]){let n=e.map(i=>{let a=t.some(c=>c.toLowerCase()===i.toLowerCase());return{skill:i,matched:a}}),s=n.filter(i=>i.matched).length,r=e.length?Math.round(s/e.length*100):0,o=n.filter(i=>!i.matched).map(i=>i.skill);return{score:r,table:n,newSkills:o}}function me(e){let t=[],n=o=>{if(o!=null){if(Array.isArray(o)){o.forEach(i=>n(i));return}if(typeof o=="object"){Object.values(o).forEach(i=>n(i));return}typeof o=="string"&&o.split(/[\n,]/).map(i=>i.trim()).filter(Boolean).forEach(i=>t.push(i))}};n(e);let s=new Set,r=[];for(let o of t){let i=o.toLowerCase();s.has(i)||(s.add(i),r.push(o))}return r}function I(e){return typeof e!="number"||Number.isNaN(e)?0:q(e,0,100)}var xe=[{key:"designation",label:"Designation match"},{key:"experience",label:"Years / experience"},{key:"skills",label:"Skill match"},{key:"tasks",label:"Task overlap"},{key:"highlights",label:"Highlights"},{key:"certifications",label:"Certifications"}],ie=8,Re=97;function D(e){return typeof e=="string"?e:""}function Me(e){return D(e).replace(/\r\n/g,`
`)}function W(e){return typeof e!="number"||Number.isNaN(e)?0:Math.round(e)}function nt(e){switch(e){case"match":return"a strong match";case"gap":return"a gap";case"partial":return"a partial match";case"info":return"informational coverage";default:return"an unknown status"}}function jn(e){switch(e){case"match":return"positive";case"gap":return"negative";case"partial":return"warning";default:return"info"}}function Bn(e=""){let t=Me(e).split(/\n/).map(s=>s.trim()).filter(Boolean);return t.length&&(t.slice(0,4).find(s=>{if(!s||s.length>80||/[.:!?]/.test(s))return!1;let o=s.split(/\s+/).filter(Boolean);return o.length===1?!1:o.filter(a=>/[A-Z]/.test(a.charAt(0))).length>=Math.max(2,Math.floor(o.length/2))})||t[0])||""}function st(e=""){return D(e).toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim()}function $n({resumeText:e,jobTitle:t}){let n=Bn(e),s=st(n),r=st(t),o="unknown",i=60,a="Headline alignment could not be determined.";if(r&&s)if(s.includes(r)||r.includes(s))o="match",i=92,a="Headline mirrors the job designation.";else{let c=new Set(r.split(" ").filter(Boolean)),u=new Set(s.split(" ").filter(Boolean)),l=Array.from(c).filter(f=>u.has(f));l.length>=Math.max(1,Math.floor(c.size/2))?(o="partial",i=78,a=`Headline overlaps with the JD designation (${l.join(", ")}).`):(o="gap",i=58,a=`Headline (\u201C${n||"\u2014"}\u201D) differs from the JD designation.`)}else r?(o="partial",i=70,a="Provide a headline so we can confirm designation alignment."):s&&(o="info",i=72,a="Job title unavailable. Keep headline focused on the target role.");return{key:"designation",label:"Designation match",score:I(i),status:o,detail:a,headline:n}}function rt(e){let t=String(e||"").trim();if(!/^\d{4}$/.test(t))return null;let n=Number(t);return Number.isFinite(n)?n:null}function Pn(e=""){let t=Me(e).toLowerCase();if(!t)return 0;let n=[],s=/(19|20)\d{2}\s*(?:-|–|to)\s*(?:present|current|(19|20)\d{2})/gi,r;for(;(r=s.exec(t))!==null;){let f=rt(r[0].slice(0,4)),g=r[0].slice(r[0].lastIndexOf(" ")+1).replace(/[^0-9a-z]/gi,"").toLowerCase(),S=new Date().getUTCFullYear(),h=g==="present"||g==="current"?S:rt(g);f&&h&&h>=f&&n.push([f,h])}let o=[];n.sort((f,d)=>f[0]-d[0]).forEach(([f,d])=>{if(!o.length){o.push([f,d]);return}let g=o[o.length-1];f<=g[1]?g[1]=Math.max(g[1],d):o.push([f,d])});let i=0;o.forEach(([f,d])=>{i+=Math.max(0,d-f+1)});let a=/(\d{1,2})\s*\+?\s*(years|yrs)/gi,c=0,u;for(;(u=a.exec(t))!==null;){let f=Number(u[1]);Number.isFinite(f)&&(c=Math.max(c,f))}let l=Math.max(i,c);return Math.min(45,Math.round(l*10)/10)}function zn(e=""){let t=D(e);if(!t)return null;let n=/(?:at\s+least|minimum(?:\s+of)?|min\.?|require(?:s|d)?|with)?\s*(\d+)(?:\s*[-–to]{1,3}\s*(\d+))?\s*(\+|plus)?\s*(?:years|yrs)/gi,s=null,r=null,o;for(;(o=n.exec(t))!==null;){let i=Number(o[1]),a=o[2]?Number(o[2]):null,c=!!o[3];if(!Number.isFinite(i))continue;let u=i,l=a;l!==null&&l<u&&([l,u]=[u,l]),c&&(l=null),(s===null||u>s)&&(s=u),l===null?r=null:r!==null?r=Math.max(r,l):r=l}return s===null?null:{minYears:s,maxYears:r}}function Fn({resumeText:e,jobDescription:t}){let n=Pn(e),s=zn(t),r="unknown",o=n>0?`Resume indicates roughly ${n} years of experience.`:"Experience duration not detected\u2014add clear timelines for each role.",i=n>0?68:52;if(s){let{minYears:a,maxYears:c}=s;n<=0?(r="gap",i=42,o=`The JD requests ${a}+ years. Add role dates to show your tenure.`):n>=a?(r="match",i=92,o=`Resume reflects ~${n} years, meeting the ${a}+ year requirement.`,c&&n>c+2&&(r="info",i=80,o+=` Frame senior projects so they align with the ${c}-year focus.`)):a-n<=1?(r="partial",i=74,o=`Within about ${Math.round((a-n)*10)/10} years of the ${a}+ requirement\u2014surface longer engagements.`):(r="gap",i=50,o=`Resume shows about ${n} years. Highlight earlier roles to close the ${a}+ year gap.`)}else n>0&&(r="info",i=76,o=`JD does not specify tenure. Resume signals ~${n} years of experience.`);return{key:"experience",label:"Years / experience",score:I(i),status:r,detail:o,candidateYears:n,requiredYears:s?.minYears??null,maximumYears:s?.maxYears??null}}function Un({matchScore:e,missingSkills:t,addedSkills:n}){let s=Array.isArray(t)?t.filter(Boolean):[],r=Array.isArray(n)?n.filter(Boolean):[],o=I(e),i="match",a=`Resume covers ${o}% of the JD skills.`;return o<70?(i=s.length?"gap":"partial",a=s.length>0?`Still missing ${s.slice(0,4).join(", ")} from the JD.`:`Resume covers ${o}% of the JD skills\u2014reinforce keywords throughout the experience section.`):r.length&&(a=`Now covers ${o}% of JD skills, adding ${r.slice(0,4).join(", ")}.`),{key:"skills",label:"Skill match",score:o,status:i,detail:a,missing:s,added:r}}function Vn({atsBreakdown:e}){let t=Number(e?.impact?.score)||0,n="unknown",s="Task alignment insights were unavailable.";return t>=80?(n="match",s="Achievement bullets mirror JD responsibilities."):t>=55?(n="partial",s="Some bullets align with the JD\u2014add measurable outcomes for task ownership."):(n="gap",s="Rework bullets to highlight JD-specific tasks and quantifiable results."),{key:"tasks",label:"Task overlap",score:I(t>=80?Math.max(t,82):t>=55?Math.max(t,68):Math.max(t,45)),status:n,detail:s,rawImpactScore:t}}function Kn({atsBreakdown:e}){let t=Number(e?.crispness?.score)||0,n=Number(e?.otherQuality?.score)||0,s=I(Math.round((t+n)/2)),r="info",o="Highlights are generally clear and skimmable.";return s>=80?(r="match",o="Highlights are crisp with measurable outcomes."):s<55&&(r="gap",o="Tighten bullets and emphasise impact to sharpen highlights."),{key:"highlights",label:"Highlights",score:s,status:r,detail:o}}function Hn({resumeText:e,jobDescription:t}){let n=Me(e).toLowerCase(),s=D(t).toLowerCase(),r=/certifications?|licenses?/i.test(e)||/certified|credential|license/i.test(e),o=/certification|certified|license|credential/.test(s),i="info",a=r?82:70,c=r?"Resume lists certifications.":"No dedicated certifications section detected.";return o&&r?(i="match",a=90,c="Resume highlights certifications requested in the JD."):o&&!r?(i="gap",a=56,c="JD references certifications\u2014add a certifications section or cite credentials in experience bullets."):!o&&r&&(i="info",a=84,c="Certifications listed\u2014ensure they stay relevant to the role."),{key:"certifications",label:"Certifications",score:I(a),status:i,detail:c,jobRequestsCerts:o,resumeHasCerts:r}}function ot({resumeText:e,jobTitle:t,jobDescription:n,matchScore:s,missingSkills:r,addedSkills:o,atsBreakdown:i}){let a={designation:$n({resumeText:e,jobTitle:t}),experience:Fn({resumeText:e,jobDescription:n}),skills:Un({matchScore:s,missingSkills:r,addedSkills:o}),tasks:Vn({atsBreakdown:i}),highlights:Kn({atsBreakdown:i}),certifications:Hn({resumeText:e,jobDescription:n})},c=xe.map(({key:m})=>{let p=a[m]?.score;return typeof p=="number"&&Number.isFinite(p)?I(p):null}).filter(m=>m!==null),u=c.length?Math.round(c.reduce((m,p)=>m+p,0)/c.length):0,l=I(u),f=null;c.length?l<ie?(l=ie,f=`Probability lifted to ${ie}% to reflect baseline interview chances.`):l>Re&&(l=Re,f=`Probability capped at ${Re}% to avoid overstating selection odds.`):(l=ie,f=`Insufficient signals detected, defaulting to ${ie}% selection probability.`);let d=l>=75?"High":l>=55?"Medium":"Low",g=[];Object.values(a).forEach(m=>{!m||!m.status||(m.status==="gap"?g.push(m.detail||`${m.label} needs attention.`):m.status==="match"&&g.push(m.detail||`${m.label} aligns with the JD.`))}),f&&g.push(f);let S=`Projected ${d.toLowerCase()} probability (${l}%) that this resume will be shortlisted for the JD`,h=g.length?`${S} because ${g.join("; ")}.`:`${S}.`;return{metrics:a,probability:l,level:d,summary:h}}function qn(e={},t={}){let n={};return xe.forEach(({key:s,label:r})=>{let o=I(e[s]?.score??0),i=I(t[s]?.score??0);n[s]={key:s,label:r,score:W(i-o),statusChange:e[s]?.status!==t[s]?.status?t[s]?.status:null}}),n}function Wn(e={},t={}){return xe.map(({key:n,label:s})=>{let r=e[n]||{},o=t[n]||{},i=o.status||r.status||"info",a=jn(i),c=r.score,u=o.score,l=typeof c=="number"&&Number.isFinite(c),f=typeof u=="number"&&Number.isFinite(u),d=l?I(c):null,g=f?I(u):null,S=l&&f?W(g-d):null,h=r.status&&o.status&&r.status!==o.status?`Status moved from ${nt(r.status)} to ${nt(o.status)}.`:"",p=D(o.detail).trim()||D(r.detail).trim();p||(i==="gap"?p=`${s} needs improvement to align with the JD.`:i==="match"?p=`${s} aligns with the JD expectations.`:i==="partial"?p=`${s} is partially aligned\u2014add more role-specific examples.`:p=`${s} provides informational signals for selection scoring.`),h&&(p=`${h} ${p}`.trim());let b={key:n,label:s,impact:a,status:i,detail:p};return d!==null&&(b.scoreBefore=d),g!==null&&(b.scoreAfter=g),S!==null&&(b.scoreDelta=S),b})}function Yn(e={},t={}){let n={};return de.forEach(({key:s,category:r})=>{let o=I(e[s]?.score??0),i=I(t[s]?.score??0);n[s]={key:s,category:r,score:W(i-o)}}),n}function Jn(e){return D(e).replace(/[^a-z0-9\-]+/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,96)}function Gn(e=[],t=[]){let n=new Set((e||[]).filter(r=>r?.matched).map(r=>(r?.skill||"").toLowerCase()).filter(Boolean)),s=(t||[]).filter(r=>r?.matched).map(r=>r?.skill||"").filter(Boolean).filter(r=>!n.has(r.toLowerCase()));return Array.from(new Set(s))}function it(e={}){let t=D(e.jobId).trim();if(!t)return{ok:!1,error:{statusCode:400,code:"JOB_ID_REQUIRED",message:"jobId is required to score the resume against the job description."}};let n=D(e.resumeText);if(!n.trim())return{ok:!1,error:{statusCode:400,code:"RESUME_TEXT_REQUIRED",message:"resumeText is required to score the resume against the job description."}};let s=D(e.enhancedResumeText)||n,r=D(e.jobDescription||e.jobDescriptionText),o=me(e.jobSkills);if(!o.length)return{ok:!1,error:{statusCode:400,code:"JOB_SKILLS_REQUIRED",message:"Provide jobSkills with at least one keyword to calculate a score."}};let i=D(e.jobTitle||e.designation||""),a=Jn(e.sessionId||e.sessionSegment||""),c=ve(n),u=ve(s),l=Ie(o,c),f=Ie(o,u),d=G(Ae(n,{jobText:r,jobSkills:o,resumeSkills:c})),g=G(Ae(s,{jobText:r,jobSkills:o,resumeSkills:u})),S=Ne(d),h=Ne(g),m=ot({resumeText:n,jobTitle:i,jobDescription:r,matchScore:l.score,missingSkills:l.newSkills,addedSkills:[],atsBreakdown:d}),p=Gn(l.table,f.table),b=ot({resumeText:s,jobTitle:i,jobDescription:r,matchScore:f.score,missingSkills:f.newSkills,addedSkills:p,atsBreakdown:g}),_=qn(m.metrics,b.metrics),w=Wn(m.metrics,b.metrics),E=Yn(d,g),O=Array.isArray(f.table)?f.table:[];return{ok:!0,result:{success:!0,jobId:t,sessionId:a||null,score:f.score,missingSkills:f.newSkills,alignmentTable:O,match:{before:{score:l.score,missingSkills:l.newSkills,table:l.table},after:{score:f.score,missingSkills:f.newSkills,table:f.table},delta:{score:W(f.score-l.score),coveredSkills:p}},ats:{before:{score:S,breakdown:d},after:{score:h,breakdown:g},delta:{score:W(h-S),breakdown:E}},selection:{before:{probability:m.probability,level:m.level,summary:m.summary,metrics:m.metrics},after:{probability:b.probability,level:b.level,summary:b.summary,metrics:b.metrics},delta:{probability:W(b.probability-m.probability),levelChange:m.level&&b.level&&m.level!==b.level?b.level:null,metrics:_},factors:w},selectionProbabilityBefore:m.probability,selectionProbabilityAfter:b.probability,selectionProbabilityDelta:W(b.probability-m.probability),selectionProbabilityFactors:w}}}function _e(e){if(!e||typeof e!="object")return{statusCode:500,headers:{"Content-Type":"application/json"},body:JSON.stringify({success:!1,code:"INTERNAL_ERROR",message:"Unable to score the resume."})};if(!e.ok){let{statusCode:t,code:n,message:s,details:r}=e.error||{};return{statusCode:t||400,headers:{"Content-Type":"application/json"},body:JSON.stringify({success:!1,code:n||"VALIDATION_ERROR",message:s||"Unable to score the resume against the job description.",...r!==void 0?{details:r}:{}})}}return{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify(e.result)}}function Zn(){return new Xn({region:process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||"us-east-1"})}var es=Zn();function j(e,{fallback:t="",maxLength:n=96}={}){if(typeof e=="number")return j(String(e),{fallback:t,maxLength:n});if(typeof e!="string"){let o=typeof t=="string"?t:typeof t=="number"?String(t):"";return o?j(o,{fallback:"",maxLength:n}):""}let s=e.trim();if(!s){let o=typeof t=="string"?t.trim():typeof t=="number"?String(t):"";return o?j(o,{fallback:"",maxLength:n}):""}let r=s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"").slice(0,n);return r||(t?j(t,{fallback:"",maxLength:n}):"")}function z(e=""){return e?e.endsWith("/")?e:`${e}/`:""}function at(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.replace(/[^/]+$/,""),s=z(n).split("/").filter(Boolean);if(s.length<3)return"";let r=s[2];return!r||/^\d{4}-\d{2}-\d{2}$/.test(r)||r==="incoming"?"":`${s.slice(0,3).join("/")}/`}function ts({ownerSegment:e,dateSegment:t,jobSegment:n,sessionSegment:s}={}){let r=j(e,{fallback:"candidate"})||"candidate",o=j(s),i=j(t),a=j(n),c=["cv",r];return o?c.push(o):(i&&c.push(i),a&&c.push(a)),`${c.join("/")}/`}function ns(e){if(typeof e!="string")return"";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");return t?t.slice(0,48):""}function ss({payload:e={},result:t={}}={}){let n=e&&typeof e.sessionPointer=="object"&&e.sessionPointer?e.sessionPointer:{},s=typeof n.prefix=="string"&&n.prefix.trim()?n.prefix.trim():"",r=typeof n.changeLogKey=="string"&&n.changeLogKey.trim()?n.changeLogKey.trim():"",o=typeof e.sessionChangeLogKey=="string"&&e.sessionChangeLogKey.trim()?e.sessionChangeLogKey.trim():"",i=r||o,a=s?z(s):"";if(!a&&i&&(a=at(i)),!a){let u=typeof e.sessionPrefix=="string"&&e.sessionPrefix.trim()?e.sessionPrefix.trim():"";u&&(a=z(u))}if(!a){let u=typeof e.originalUploadKey=="string"&&e.originalUploadKey.trim()?e.originalUploadKey.trim():"";u&&(a=at(u))}return{sessionPrefix:a?z(a):"",changeLogKey:i}}function rs({payload:e={},result:t={}}={}){let n=new Date().toISOString().replace(/[:.]/g,"-"),{sessionPrefix:s,changeLogKey:r}=ss({payload:e,result:t});if(s)return{key:`${z(s)}logs/scoring/${n}.json`,context:{sessionPrefix:z(s),...r?{changeLogKey:r}:{}}};let o=e&&typeof e.sessionPointer=="object"&&e.sessionPointer?e.sessionPointer:{},i=j(e.ownerSegment??o.ownerSegment??e.userId??o.userId??"")||"candidate",a=j(t.sessionId??e.sessionId??e.sessionSegment??o.sessionId??o.sessionSegment??""),c=j(e.dateSegment??o.dateSegment??""),u=ns(t.jobId??e.jobId??o.jobId??""),l=ts({ownerSegment:i,sessionSegment:a,dateSegment:c,jobSegment:u});return{key:`${z(l)}logs/scoring/${n}.json`,context:{sessionPrefix:z(l)}}}async function os({payload:e,result:t}){let n=typeof process.env.S3_BUCKET=="string"?process.env.S3_BUCKET.trim():"";if(!n)throw new Error("S3_BUCKET environment variable is required to store scoring audits.");let{key:s,context:r}=rs({payload:e,result:t}),o={};r?.sessionPrefix&&(o.sessionPrefix=z(r.sessionPrefix)),r?.changeLogKey&&(o.changeLogKey=r.changeLogKey);let i=JSON.stringify({jobId:t.jobId,sessionId:t.sessionId||e.sessionId||e.sessionSegment||null,createdAt:new Date().toISOString(),...Object.keys(o).length?{context:o}:{},result:t},null,2);return await es.send(new Qn(oe({Bucket:n,Key:s,Body:i,ContentType:"application/json"}))),{bucket:n,key:s,...Object.keys(o).length?{context:o}:{}}}async function ct(e,t){let n=Ze(e),s=it(n);if(s.ok)try{let r=await os({payload:n,result:s.result});s.result.audit=r}catch(r){s.result.audit={error:{message:r?.message||"Unable to persist scoring audit to S3."}}}return _e(s)}function is(e={}){return{httpMethod:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}}function as(){return{awsRequestId:`scoring-service-${Date.now().toString(36)}-${Math.random().toString(16).slice(2)}`,functionName:"scoring-service-proxy",invokedFunctionArn:"arn:aws:lambda:local:0:function:scoring-service-proxy",callbackWaitsForEmptyEventLoop:!1}}function cs(e){if(e===null||typeof e>"u")return{};if(typeof e=="object")return e;if(typeof e!="string")return{};try{return JSON.parse(e)}catch{return{}}}function ls(e){if(!e||typeof e!="object")return{ok:!1,error:{statusCode:500,code:"SCORING_HANDLER_INVALID_RESPONSE",message:"Scoring handler returned an invalid response."}};let t=Number(e.statusCode||500),n=cs(e.body);if(t>=200&&t<300)return{ok:!0,result:n&&typeof n=="object"?n:{}};let s=n&&typeof n=="object"?n.details:void 0;return{ok:!1,error:{statusCode:t,code:n&&typeof n.code=="string"&&n.code.trim()?n.code.trim():"SCORING_FAILED",message:n&&typeof n.message=="string"&&n.message.trim()?n.message.trim():"Unable to score the resume against the job description.",...s!==void 0?{details:s}:{}}}}async function lt(e={}){try{let t=is(e),n=as(),s=await ct(t,n);return ls(s)}catch(t){return{ok:!1,error:{statusCode:500,code:"SCORING_HANDLER_ERROR",message:t?.message||"Unable to invoke the scoring service handler.",details:t}}}}import{CloudWatchClient as Cs,PutMetricDataCommand as Oe}from"@aws-sdk/client-cloudwatch";import{S3Client as Ns}from"@aws-sdk/client-s3";import{randomUUID as Nt}from"crypto";import{GetObjectCommand as Ss,PutObjectCommand as ht}from"@aws-sdk/client-s3";var ut=new Set(["ECONNRESET","ECONNREFUSED","ETIMEDOUT","EPIPE","EAI_AGAIN","ENOTFOUND","ECONNABORTED","ENETUNREACH","EHOSTUNREACH"]),ft=new Set(["SLOWDOWN","SLOWDOWNERROR","REQUESTTIMEOUT","THROTTLING","THROTTLINGEXCEPTION","SERVICEUNAVAILABLE","INTERNALERROR"]);function us(e){return new Promise(t=>setTimeout(t,e))}function pe(e){if(!(!e||typeof e!="object")){if(typeof e.status=="number")return e.status;if(typeof e.statusCode=="number")return e.statusCode;if(typeof e.$metadata?.httpStatusCode=="number")return e.$metadata.httpStatusCode;if(typeof e.response?.status=="number")return e.response.status;if(typeof e.cause?.status=="number")return e.cause.status;if(typeof e.cause?.statusCode=="number")return e.cause.statusCode}}function fs(e){return Number.isFinite(e)?e===429||e>=500:!1}function ds(e){if(!e||typeof e!="object")return!1;let t=typeof e.code=="string"?e.code.toUpperCase():"";if(t&&ut.has(t))return!0;let n=typeof e.name=="string"?e.name.toUpperCase():"";if(n&&ut.has(n))return!0;let s=typeof e.message=="string"?e.message.toLowerCase():"";return s?s.includes("timed out")||s.includes("timeout")||s.includes("temporarily unavailable")||s.includes("connection reset")||s.includes("socket hang up"):!1}function ke(e){if(!e||typeof e!="object")return!1;let t=pe(e);if(fs(t)||ds(e))return!0;let n=typeof e.code=="string"?e.code.toUpperCase():"";if(n&&ft.has(n))return!0;let s=typeof e.name=="string"?e.name.toUpperCase():"";return!!(s&&ft.has(s))}async function De(e,t={}){let{maxAttempts:n=3,baseDelayMs:s=500,maxDelayMs:r=5e3,jitterMs:o=250,shouldRetry:i=()=>!1,onRetry:a}=t,c;for(let u=1;u<=n;u+=1)try{return await e(u)}catch(l){if(c=l,!(u<n&&i(l,u)))throw l;let d=s*2**(u-1),g=Math.min(r,d),S=o>0?Math.floor(Math.random()*o):0,h=Math.max(0,g+S);if(typeof a=="function")try{a(l,u,h)}catch{}await us(h)}throw c}import{randomBytes as ws,randomUUID as mt}from"crypto";function B(e){return e==null?"":typeof e=="string"?e.trim():typeof e=="number"||typeof e=="bigint"?String(e):""}function ae(...e){for(let t of e){let n=B(t);if(n)return n}return""}function ms(){return ae(process.env.RESUMEFORGE_BUILD_ID,process.env.BUILD_ID,process.env.DEPLOYMENT_BUILD_ID,process.env.GITHUB_RUN_ID,process.env.GITHUB_SHA,process.env.AWS_LAMBDA_FUNCTION_VERSION)||"local-dev"}var ps=ms();function gs(e={}){return ae(e.build,e.buildId,e.metadata?.build,e.metadata?.buildId)||ps}function hs(e={}){let t=n=>Array.isArray(n)&&n.length?n[0]:"";return ae(e.template,e.templateId,e.resumeTemplate,e.coverTemplate,e.preferredTemplate,e.canonicalSelectedTemplate,e.selectedTemplate,e.template1,e.template2,t(e.templates),t(e.availableCvTemplates),e.coverTemplate1,e.coverTemplate2)||"unknown"}function ys(e={}){return ae(e.session,e.sessionId,e.jobId,e.requestId,e.detail?.sessionId,e.detail?.jobId,e.metadata?.session,e.metadata?.sessionId)||"unknown"}function bs(e={}){let t=Array.isArray(e.urls)?e.urls:[],n=t.length>0?B(t[0]?.type):"",s=()=>{let r=B(e.event);return r?r.includes("cover_letter")?"cover_letter":r.includes("generation_artifacts")?"generated_artifact":r.includes("initial_upload")?"upload_artifact":"":""};return ae(e.artifactType,e.metadata?.artifactType,e.type,e.cleanupEvent,n,s())||"none"}function ge(e={},t={},n={}){let{embedMetadata:s=!0}=n;if(!e||typeof e!="object")return e;let r={...typeof e.metadata=="object"&&e.metadata?e.metadata:{},...typeof t.metadata=="object"&&t.metadata?t.metadata:{}},o={...r,...e,...t},i=hs(o),a=ys(o),c=gs({...o,metadata:r}),u=bs(o),l={...e};B(l.template)||(l.template=i),B(l.session)||(l.session=a),B(l.build)||(l.build=c),B(l.artifactType)||(l.artifactType=u);let f={...r};return B(f.template)||(f.template=i),B(f.session)||(f.session=a),B(f.build)||(f.build=c),B(f.artifactType)||(f.artifactType=u),s?(Object.keys(f).length>0&&(l.metadata=f),l):f}function dt(e={},t={}){let n=ge(e,t,{embedMetadata:!1});return!n||typeof n!="object"?{}:n}async function Es(e){return await new Promise((t,n)=>{let s=[];e.on("data",r=>s.push(r)),e.on("error",n),e.on("end",()=>t(Buffer.concat(s).toString("utf-8")))})}async function yt({s3:e,bucket:t,key:n,jobId:s,event:r,level:o="info",message:i,metadata:a,template:c,session:u,build:l,artifactType:f}){let d={jobId:s,template:c,session:u,build:l,artifactType:f},g=a&&typeof a=="object"&&!Array.isArray(a)?a:{},S=dt(g,d),h=ge({timestamp:new Date().toISOString(),jobId:s,event:r,level:o,...i?{message:i}:{},metadata:S},d),m="";try{let b=await e.send(new Ss({Bucket:t,Key:n}));m=await Es(b.Body)}catch(b){if(b.name!=="NoSuchKey"&&b.$metadata?.httpStatusCode!==404)throw b}let p=m+JSON.stringify(h)+`
`;await De(()=>e.send(new ht(re(oe({Bucket:t,Key:n,Body:p,ContentType:"application/json"})))),{maxAttempts:4,baseDelayMs:500,maxDelayMs:4e3,jitterMs:300,shouldRetry:b=>ke(b),onRetry:(b,_,w)=>{console.warn("Retrying S3 log upload",{bucket:t,key:n,attempt:_,delayMs:w,status:pe(b),code:b?.code})}})}function pt(){if(typeof mt=="function")try{return mt()}catch{}return ws(16).toString("hex")}function gt(e){return e?String(e).trim().replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/^-+|-+$/g,"").slice(0,80):""}function Ts(e=""){if(!e)return"";let t=e.replace(/^\/+/,"").replace(/\/+/g,"/");return t.endsWith("/")?t:`${t}/`}async function bt({s3:e,bucket:t,entry:n,prefix:s="logs/errors/",key:r}){if(!e||!t||!n)return;let o=typeof n?.timestamp=="string"&&n.timestamp.trim()?n.timestamp:new Date().toISOString(),i=o.slice(0,10),a=gt(n.requestId)||pt(),c=gt(o)||pt(),u=Ts(s),l=typeof r=="string"&&r.trim()?r.trim():`${u}${i}/${c}-${a}.json`,f=ge({...n,timestamp:o},{jobId:n?.jobId,template:n?.template,session:n?.session,build:n?.build,artifactType:n?.artifactType,metadata:n?.metadata});await De(()=>e.send(new ht(re(oe({Bucket:t,Key:l,Body:JSON.stringify(f),ContentType:"application/json"})))),{maxAttempts:4,baseDelayMs:500,maxDelayMs:4e3,jitterMs:300,shouldRetry:d=>ke(d),onRetry:(d,g,S)=>{console.warn("Retrying S3 trace upload",{bucket:t,key:r,attempt:g,delayMs:S,status:pe(d),code:d?.code})}})}var ce=process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||void 0,he=ce?new Cs({region:ce}):null,be=ce?new Ns({region:ce}):null,St=process.env.METRICS_NAMESPACE||"ResumeForge/Operations",As=process.env.ARTIFACT_METRICS_NAMESPACE||"ResumeForge/Artifacts",Le=process.env.SESSION_CHANGE_LOG_PREFIX||"logs/sessions/",vs=process.env.LAMBDA_ERROR_TRACE_PREFIX||"logs/errors/",Is=process.env.ARTIFACT_FAILURE_LOG_PREFIX||"logs/artifact-failures/",X=process.env.LOGS_BUCKET||process.env.S3_BUCKET||"",Q=process.env.STAGE_NAME||process.env.DEPLOYMENT_ENVIRONMENT||"prod",Rs=/^\/(?:assets|fonts|images|cover-templates)(?:\b|\/)/i,wt=Object.freeze({"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Methods":"OPTIONS,GET,POST"}),xs="An unexpected error occurred. Please try again later.",Ms="The request could not be completed.";function _s(e={},t={}){return e?.requestContext?.requestId||e?.headers?.["x-amzn-requestid"]||e?.headers?.["x-amzn-request-id"]||t?.awsRequestId||Nt()}function ks(e={}){if(!e||typeof e!="object")return"";if(typeof e.sessionId=="string"&&e.sessionId.trim())return e.sessionId.trim();if(typeof e.jobId=="string"&&e.jobId.trim())return e.jobId.trim();if(typeof e.detail=="object"&&e.detail){let t=e.detail;if(typeof t.sessionId=="string"&&t.sessionId.trim())return t.sessionId.trim();if(typeof t.jobId=="string"&&t.jobId.trim())return t.jobId.trim()}if(Array.isArray(e.Records)&&e.Records.length>0){let t=e.Records[0];if(t&&typeof t.body=="string")try{let n=JSON.parse(t.body);if(n&&typeof n=="object"){if(typeof n.sessionId=="string"&&n.sessionId.trim())return n.sessionId.trim();if(typeof n.jobId=="string"&&n.jobId.trim())return n.jobId.trim();if(n.payload&&typeof n.payload=="object"&&typeof n.payload.jobId=="string"&&n.payload.jobId.trim())return n.payload.jobId.trim()}}catch{}}return""}function Ds(e=""){return String(e).trim().replace(/[^a-zA-Z0-9._-]+/g,"-").replace(/^-+|-+$/g,"").slice(0,120)}function Os(e,t){let n=e||t;if(!n)return"";let s=Ds(n);return`${Le.endsWith("/")?Le:`${Le}/`}${s}.jsonl`}function Ls(e={}){return e?.requestContext?.http?{type:"http",method:e.requestContext.http.method,path:e.requestContext.http.path,protocol:e.requestContext.http.protocol,sourceIp:e.requestContext.http.sourceIp,userAgent:e.requestContext.http.userAgent}:typeof e.httpMethod=="string"&&typeof e.path=="string"?{type:"http-legacy",method:e.httpMethod,path:e.path}:Array.isArray(e.Records)?{type:"records",recordCount:e.Records.length,sources:Array.from(new Set(e.Records.map(t=>t.eventSource||t.EventSource||t.source).filter(Boolean)))}:e?.detailType||e?.source?{type:"event-bridge",detailType:e.detailType,source:e.source}:e?.source==="aws.states"?{type:"step-functions"}:{type:typeof e}}function js(e){if(!e||typeof e!="object")return{};let t={};for(let[n,s]of Object.entries(e))typeof n=="string"&&(t[n.toLowerCase()]=s);return t}function Et(e){if(typeof e!="string")return null;let t=e.trim();if(!t||!t.startsWith("{")&&!t.startsWith("["))return null;try{return JSON.parse(t)}catch{return null}}function Bs(e){return e&&Array.isArray(e)?e.filter(t=>t!=null).length:0}function $s(e){if(!e||typeof e!="object")return 0;let t=[e.sessionCount,e.totalSessions,e.sessions?.length,e.sessionLogs?.length].filter(s=>Number.isFinite(s)&&s>0),n=t.length?Math.max(...t.map(s=>Number(s))):0;return typeof e.sessionId=="string"&&e.sessionId.trim()&&(n=Math.max(n,1)),Array.isArray(e.sessionIds)&&(n=Math.max(n,e.sessionIds.length)),Array.isArray(e.sessions)&&(n=Math.max(n,e.sessions.length)),Array.isArray(e.sessionLogs)&&(n=Math.max(n,e.sessionLogs.length)),n}var Ps=["urls","downloads","downloadUrls","download_logs","downloadLogs","files","artifacts","links"],zs=["downloadCount","totalDownloads","downloadTotal"];function Fs(e){if(!e||typeof e!="object")return 0;let t=0;for(let n of zs){let s=e[n];Number.isFinite(s)&&s>0&&(t=Math.max(t,Number(s)))}for(let n of Ps)Array.isArray(e[n])&&(t=Math.max(t,Bs(e[n])));return t}function Us(e={},t={}){return typeof t?.path=="string"&&t.path?t.path:typeof e?.rawPath=="string"&&e.rawPath?e.rawPath:typeof e?.path=="string"&&e.path?e.path:typeof e?.requestContext?.http?.path=="string"?e.requestContext.http.path:""}function Vs(e={},t={}){return typeof t?.method=="string"&&t.method?t.method:typeof e?.requestContext?.http?.method=="string"?e.requestContext.http.method:typeof e?.httpMethod=="string"?e.httpMethod:""}function Ks(e=""){if(typeof e!="string"||!e)return"unknown";if(e==="/"||e==="")return"root";if(e.startsWith("/api/")){let[,,t]=e.split("/",3);return t?`/api/${t}`:"/api"}return e.startsWith("/assets")?"/assets":e.startsWith("/fonts")?"/fonts":e.startsWith("/images")?"/images":e.startsWith("/cover-templates")?"/cover-templates":e.split("?")[0]||"unknown"}function Hs(e,{event:t,requestMetadata:n,durationMs:s}={}){if(!e||typeof e!="object")return null;let r=js(e.headers),o=Number.isInteger(e.statusCode)?Number(e.statusCode):void 0,i=Vs(t,n),a=Us(t,n),c=r["content-length"],u=c!==void 0?Number(c):!e.isBase64Encoded&&typeof e.body=="string"?Buffer.byteLength(e.body):void 0,l=null,f=r["content-type"],d=typeof f=="string"&&/json/i.test(f);!e.isBase64Encoded&&typeof e.body=="string"&&e.body&&(l=Et(e.body));let g=$s(l),S=Fs(l),h=Ks(a),m=Rs.test(a);return{statusCode:o,method:i,path:a,pathCategory:h,contentLength:Number.isFinite(u)?u:void 0,sessionCount:Number.isFinite(g)&&g>0?g:0,downloadCount:Number.isFinite(S)&&S>0?S:0,isAssetRequest:m,durationMs:Number.isFinite(s)?s:void 0}}function qs(e={}){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([,t])=>t!=null))}function Tt(e={}){return!e||typeof e!="object"?!1:!!(typeof e.httpMethod=="string"||e?.requestContext?.http&&typeof e.requestContext.http.method=="string"||typeof e.version=="string"&&e.version.startsWith("2")&&(typeof e.rawPath=="string"||typeof e.routeKey=="string")||typeof e.rawPath=="string"&&typeof e.requestContext=="object"||typeof e.resource=="string"&&typeof e.path=="string")}function Ws(e){return[e?.statusCode,e?.status,e?.httpStatus,e?.response?.status,e?.output?.statusCode].find(s=>Number.isInteger(s)&&s>=400&&s<=599)??500}function Ys(e,t){return typeof e?.code=="string"&&e.code.trim()?e.code.trim():t>=500?"INTERNAL_SERVER_ERROR":"BAD_REQUEST"}function Js(e,t){return typeof e?.message=="string"&&e.message.trim()?e.message.trim():t>=500?xs:Ms}function Gs(e){if(e?.details!==void 0)return e.details;if(e?.errors!==void 0)return e.errors;if(e?.data!==void 0)return e.data;if(e?.response?.data!==void 0)return e.response.data}function Qs(e){return!e||typeof e!="object"?{...wt}:{...wt,...e}}function Xs(e,{requestId:t}={}){let n=Ws(e),s=Ys(e,n),r=Js(e,n),o=Gs(e),i={success:!1,code:s,message:r,...o!==void 0?{details:o}:{},...t?{requestId:t}:{}},a;if(typeof e?.body=="string")a=e.body;else if(e?.body&&typeof e.body=="object")try{a=JSON.stringify(e.body)}catch{a=JSON.stringify(i)}else a=JSON.stringify(i);return{statusCode:n,headers:Qs(e?.headers),body:a,isBase64Encoded:!!(e?.isBase64Encoded&&a===e?.body)}}function Zs(e,t,n){if(!e)return[];let s=(o={})=>{let i=t.map(a=>({...a}));e.pathCategory&&i.push({Name:"Path",Value:e.pathCategory}),e.method&&i.push({Name:"Method",Value:e.method}),e.isAssetRequest&&i.push({Name:"AssetRequest",Value:"true"});for(let[a,c]of Object.entries(o))typeof a=="string"&&typeof c=="string"&&i.push({Name:a,Value:c});return i},r=[];return e.isAssetRequest&&Number.isFinite(e.durationMs)&&r.push({MetricName:"AssetResponseDuration",Dimensions:s(),Timestamp:n,Unit:"Milliseconds",Value:e.durationMs}),e.statusCode===404&&r.push({MetricName:"HttpNotFound",Dimensions:s(),Timestamp:n,Unit:"Count",Value:1}),Number.isFinite(e.sessionCount)&&e.sessionCount>0&&r.push({MetricName:"SessionCount",Dimensions:s({Detail:"Sessions"}),Timestamp:n,Unit:"Count",Value:e.sessionCount}),Number.isFinite(e.downloadCount)&&e.downloadCount>0&&r.push({MetricName:"DownloadCount",Dimensions:s({Detail:"Downloads"}),Timestamp:n,Unit:"Count",Value:e.downloadCount}),r}async function Ct({functionName:e,durationMs:t,success:n,coldStart:s,operationGroup:r,httpSummary:o}){if(!he||!ce)return;let i=new Date,a=[{Name:"FunctionName",Value:e},{Name:"Stage",Value:Q}];r&&a.push({Name:"Operation",Value:r});let c=[{MetricName:"InvocationDuration",Dimensions:a,Timestamp:i,Unit:"Milliseconds",Value:t},{MetricName:"InvocationCount",Dimensions:[...a,{Name:"Status",Value:n?"Success":"Failure"}],Timestamp:i,Unit:"Count",Value:1}];s&&c.push({MetricName:"ColdStart",Dimensions:a,Timestamp:i,Unit:"Count",Value:1});try{await he.send(new Oe({Namespace:St,MetricData:c}))}catch(d){console.warn("Failed to publish lambda metrics",{functionName:e,stage:Q,errorMessage:d?.message})}let u=Zs(o,a,i);if(u.length)try{await he.send(new Oe({Namespace:St,MetricData:u}))}catch(d){console.warn("Failed to publish HTTP summary metrics",{functionName:e,stage:Q,errorMessage:d?.message})}if(!r)return;let l=n?"Success":"Failure",f=[{MetricName:`${r.replace(/-/g," ").replace(/\s+/g,"")}${l}`,Dimensions:[{Name:"Operation",Value:r},{Name:"Stage",Value:Q}],Timestamp:i,Unit:"Count",Value:1}];try{await he.send(new Oe({Namespace:As,MetricData:f}))}catch(d){console.warn("Failed to publish artifact metrics",{operationGroup:r,stage:Q,errorMessage:d?.message})}}async function ye({sessionId:e,requestId:t,jobId:n,event:s,metadata:r}){if(!be||!X)return;let o=Os(e,t);if(o)try{await yt({s3:be,bucket:X,key:o,jobId:n||e||t,event:s,metadata:re({...r,stage:Q})})}catch(i){console.warn("Failed to append session change log",{key:o,bucket:X,event:s,errorMessage:i?.message})}}async function er({error:e,requestId:t,sessionId:n,jobId:s,functionName:r,operationGroup:o,metadata:i,prefix:a}){if(!be||!X||!e)return;let c={requestId:t,sessionId:n,jobId:s,functionName:r,operationGroup:o,message:e.message,stack:e.stack,metadata:i};try{await bt({s3:be,bucket:X,entry:c,prefix:a})}catch(u){console.warn("Failed to upload lambda error trace",{functionName:r,bucket:X,errorMessage:u?.message})}}function At(e,{name:t="lambda-function",operationGroup:n,captureErrorTrace:s=!1}={}){if(typeof e!="function")throw new TypeError("withLambdaObservability expects a handler function.");let r=!0;return async function(i,a){let c=a?.functionName||t,u=_s(i,a),l=ks(i),f=typeof i?.jobId=="string"?i.jobId:"",d=Nt(),g=Ls(i);console.info("Lambda invocation started",{invocationId:d,functionName:c,requestId:u,sessionId:l,jobId:f,coldStart:r,operationGroup:n,requestMetadata:g}),await ye({sessionId:l,requestId:u,jobId:f,event:"lambda_invocation_started",metadata:{invocationId:d,functionName:c,operationGroup:n,coldStart:r,requestMetadata:g}});let S=Date.now();try{let h=await e(i,a),m=Date.now()-S;console.info("Lambda invocation completed",{invocationId:d,functionName:c,requestId:u,sessionId:l,jobId:f,durationMs:m,operationGroup:n,coldStart:r});let p=Tt(i)?Hs(h,{event:i,requestMetadata:g,durationMs:m}):null;if(p){let b=qs({invocationId:d,functionName:c,requestId:u,sessionId:l,jobId:f,operationGroup:n,durationMs:m,method:p.method,path:p.path,pathCategory:p.pathCategory,statusCode:p.statusCode,contentLength:p.contentLength,sessionCount:p.sessionCount,downloadCount:p.downloadCount,assetRequest:p.isAssetRequest||void 0});console.info("API gateway response summary",b),p.isAssetRequest&&console.info("API gateway asset response",b),p.statusCode===404&&console.warn("API gateway not found response",b),(Number.isFinite(p.sessionCount)&&p.sessionCount>0||Number.isFinite(p.downloadCount)&&p.downloadCount>0)&&console.info("API gateway session download totals",{...b,sessionCount:p.sessionCount,downloadCount:p.downloadCount}),await ye({sessionId:l,requestId:u,jobId:f,event:"lambda_http_response_summary",metadata:{...b,requestMetadata:g}})}return await ye({sessionId:l,requestId:u,jobId:f,event:"lambda_invocation_succeeded",metadata:{invocationId:d,functionName:c,operationGroup:n,durationMs:m,coldStart:r}}),await Ct({functionName:c,durationMs:m,success:!0,coldStart:r,operationGroup:n,httpSummary:p}),r=!1,h}catch(h){let m=Date.now()-S;if(console.error("Lambda invocation failed",{invocationId:d,functionName:c,requestId:u,sessionId:l,jobId:f,durationMs:m,operationGroup:n,coldStart:r,errorMessage:h?.message,errorCode:h?.code}),await ye({sessionId:l,requestId:u,jobId:f,event:"lambda_invocation_failed",metadata:{invocationId:d,functionName:c,operationGroup:n,durationMs:m,coldStart:r,errorMessage:h?.message,errorCode:h?.code}}),await Ct({functionName:c,durationMs:m,success:!1,coldStart:r,operationGroup:n,httpSummary:void 0}),(s||n&&["artifact-generation","artifact-download","enhancement"].includes(n))&&await er({error:h,requestId:u,sessionId:l,jobId:f,functionName:c,operationGroup:n,metadata:{invocationId:d,durationMs:m,requestMetadata:g},prefix:n==="artifact-generation"||n==="artifact-download"||n==="enhancement"?Is:vs}),r=!1,Tt(i))return Xs(h,{requestId:u});throw h}}}function tr(e){return Array.isArray(e)?e.filter(Boolean):me(e)}var nr=async(e={})=>{let t=typeof e.jobId=="string"?e.jobId.trim():"",n=typeof e.resumeText=="string"?e.resumeText:"",s=tr(e.jobSkills),r=typeof e.jobDescription=="string"?e.jobDescription:"",o=await lt({jobId:t,resumeText:n,jobSkills:s,jobDescription:r});if(!o.ok){let i=new Error(o.error?.message||"Unable to score resume");throw i.code=o.error?.code||"SCORING_FAILED",i.details=o.error,i}return{jobId:t,score:o.result.score,missingSkills:o.result.missingSkills||[],alignmentTable:o.result.alignmentTable||[]}},sr=At(nr,{name:"workflow-score",operationGroup:"scoring",captureErrorTrace:!0}),Xr=sr;export{Xr as default,sr as handler};
