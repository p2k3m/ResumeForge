import { createRequire as __createRequire } from 'module';
import { fileURLToPath as __fileURLToPath } from 'url';
import path from 'path';
const require = __createRequire(import.meta.url);
const __filename = __fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
globalThis.__filename = globalThis.__filename || __filename;
globalThis.__dirname = globalThis.__dirname || __dirname;
var ot=Object.create;var Se=Object.defineProperty;var it=Object.getOwnPropertyDescriptor;var at=Object.getOwnPropertyNames;var ct=Object.getPrototypeOf,lt=Object.prototype.hasOwnProperty;var ne=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var we=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ut=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of at(t))!lt.call(e,s)&&s!==n&&Se(e,s,{get:()=>t[s],enumerable:!(r=it(t,s))||r.enumerable});return e};var ft=(e,t,n)=>(n=e!=null?ot(ct(e)):{},ut(t||!e||!e.__esModule?Se(n,"default",{value:e,enumerable:!0}):n,e));var ve=we((An,dt)=>{dt.exports={name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var Ne=we((Cn,O)=>{var ae=ne("fs"),re=ne("path"),mt=ne("os"),ht=ne("crypto"),gt=ve(),ce=gt.version,pt=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function bt(e){let t={},n=e.toString();n=n.replace(/\r\n?/mg,`
`);let r;for(;(r=pt.exec(n))!=null;){let s=r[1],o=r[2]||"";o=o.trim();let i=o[0];o=o.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),i==='"'&&(o=o.replace(/\\n/g,`
`),o=o.replace(/\\r/g,"\r")),t[s]=o}return t}function yt(e){e=e||{};let t=ke(e);e.path=t;let n=x.configDotenv(e);if(!n.parsed){let i=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw i.code="MISSING_DATA",i}let r=Te(e).split(","),s=r.length,o;for(let i=0;i<s;i++)try{let a=r[i].trim(),c=wt(n,a);o=x.decrypt(c.ciphertext,c.key);break}catch(a){if(i+1>=s)throw a}return x.parse(o)}function St(e){console.log(`[dotenv@${ce}][WARN] ${e}`)}function X(e){console.log(`[dotenv@${ce}][DEBUG] ${e}`)}function xe(e){console.log(`[dotenv@${ce}] ${e}`)}function Te(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function wt(e,t){let n;try{n=new URL(t)}catch(a){if(a.code==="ERR_INVALID_URL"){let c=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw c.code="INVALID_DOTENV_KEY",c}throw a}let r=n.password;if(!r){let a=new Error("INVALID_DOTENV_KEY: Missing key part");throw a.code="INVALID_DOTENV_KEY",a}let s=n.searchParams.get("environment");if(!s){let a=new Error("INVALID_DOTENV_KEY: Missing environment part");throw a.code="INVALID_DOTENV_KEY",a}let o=`DOTENV_VAULT_${s.toUpperCase()}`,i=e.parsed[o];if(!i){let a=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${o} in your .env.vault file.`);throw a.code="NOT_FOUND_DOTENV_ENVIRONMENT",a}return{ciphertext:i,key:r}}function ke(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(let n of e.path)ae.existsSync(n)&&(t=n.endsWith(".vault")?n:`${n}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=re.resolve(process.cwd(),".env.vault");return ae.existsSync(t)?t:null}function Ee(e){return e[0]==="~"?re.join(mt.homedir(),e.slice(1)):e}function vt(e){let t=!!(e&&e.debug),n=e&&"quiet"in e?e.quiet:!0;(t||!n)&&xe("Loading env from encrypted .env.vault");let r=x._parseVault(e),s=process.env;return e&&e.processEnv!=null&&(s=e.processEnv),x.populate(s,r,e),{parsed:r}}function Et(e){let t=re.resolve(process.cwd(),".env"),n="utf8",r=!!(e&&e.debug),s=e&&"quiet"in e?e.quiet:!0;e&&e.encoding?n=e.encoding:r&&X("No encoding is specified. UTF-8 is used by default");let o=[t];if(e&&e.path)if(!Array.isArray(e.path))o=[Ee(e.path)];else{o=[];for(let f of e.path)o.push(Ee(f))}let i,a={};for(let f of o)try{let l=x.parse(ae.readFileSync(f,{encoding:n}));x.populate(a,l,e)}catch(l){r&&X(`Failed to load ${f} ${l.message}`),i=l}let c=process.env;if(e&&e.processEnv!=null&&(c=e.processEnv),x.populate(c,a,e),r||!s){let f=Object.keys(a).length,l=[];for(let u of o)try{let h=re.relative(process.cwd(),u);l.push(h)}catch(h){r&&X(`Failed to load ${u} ${h.message}`),i=h}xe(`injecting env (${f}) from ${l.join(",")}`)}return i?{parsed:a,error:i}:{parsed:a}}function xt(e){if(Te(e).length===0)return x.configDotenv(e);let t=ke(e);return t?x._configVault(e):(St(`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`),x.configDotenv(e))}function Tt(e,t){let n=Buffer.from(t.slice(-64),"hex"),r=Buffer.from(e,"base64"),s=r.subarray(0,12),o=r.subarray(-16);r=r.subarray(12,-16);try{let i=ht.createDecipheriv("aes-256-gcm",n,s);return i.setAuthTag(o),`${i.update(r)}${i.final()}`}catch(i){let a=i instanceof RangeError,c=i.message==="Invalid key length",f=i.message==="Unsupported state or unable to authenticate data";if(a||c){let l=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw l.code="INVALID_DOTENV_KEY",l}else if(f){let l=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw l.code="DECRYPTION_FAILED",l}else throw i}}function kt(e,t,n={}){let r=!!(n&&n.debug),s=!!(n&&n.override);if(typeof t!="object"){let o=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw o.code="OBJECT_REQUIRED",o}for(let o of Object.keys(t))Object.prototype.hasOwnProperty.call(e,o)?(s===!0&&(e[o]=t[o]),r&&X(s===!0?`"${o}" is already defined and WAS overwritten`:`"${o}" is already defined and was NOT overwritten`)):e[o]=t[o]}var x={configDotenv:Et,_configVault:vt,_parseVault:yt,config:xt,decrypt:Tt,parse:bt,populate:kt};O.exports.configDotenv=x.configDotenv;O.exports._configVault=x._configVault;O.exports._parseVault=x._parseVault;O.exports.config=x.config;O.exports.decrypt=x.decrypt;O.exports.parse=x.parse;O.exports.populate=x.populate;O.exports=x});var Ie=ft(Ne(),1);import _t from"fs";import It from"path";import I from"process";import N from"node:process";function k(e){return typeof e=="string"&&e.trim().length>0}function P(e){return typeof e=="string"?e.trim():""}var Ae=new Map(Object.entries({development:"dev",dev:"dev",production:"prod",prod:"prod",staging:"stage",stage:"stage",testing:"test",test:"test"}));function ee(e){let t=P(e).toLowerCase();return t?Ae.has(t)?Ae.get(t):t:""}function Nt(){let e=P(N.env.NODE_ENV);return ee(e)}function Ce(){if(k(N.env.STAGE_NAME)){let t=ee(N.env.STAGE_NAME);if(t)return t}if(k(N.env.DEPLOYMENT_ENVIRONMENT)){let t=ee(N.env.DEPLOYMENT_ENVIRONMENT);if(t)return t}let e=Nt();return e||"dev"}function At({stageName:e}={}){if(k(N.env.DEPLOYMENT_ENVIRONMENT)){let n=ee(N.env.DEPLOYMENT_ENVIRONMENT);if(n)return n}let t=k(e)?ee(e):Ce();return t||"dev"}function Me(){return k(N.env.DATA_BUCKET)?P(N.env.DATA_BUCKET):k(N.env.S3_BUCKET)?P(N.env.S3_BUCKET):""}function Ct({dataBucket:e}={}){if(k(N.env.STATIC_ASSETS_BUCKET))return P(N.env.STATIC_ASSETS_BUCKET);if(k(e))return P(e);let t=Me();return t||""}function Mt(){return k(N.env.LOGS_BUCKET)?P(N.env.LOGS_BUCKET):""}function B(e,t){typeof e=="string"&&k(t)&&(N.env[e]=P(t))}function _e({propagateToProcessEnv:e=!0,propagateViteEnv:t=!1}={}){let n=Ce(),r=At({stageName:n}),s=Me(),o=Ct({dataBucket:s}),i=Mt();return e&&(B("STAGE_NAME",n),B("DEPLOYMENT_ENVIRONMENT",r),k(s)&&B("S3_BUCKET",s),k(o)&&B("STATIC_ASSETS_BUCKET",o),k(i)&&B("LOGS_BUCKET",i)),t&&(B("VITE_STAGE_NAME",n),B("VITE_DEPLOYMENT_ENVIRONMENT",r),k(s)&&(B("VITE_S3_BUCKET",s),B("VITE_DATA_BUCKET",s)),k(o)&&B("VITE_STATIC_ASSETS_BUCKET",o),k(i)&&B("VITE_LOGS_BUCKET",i)),{stageName:n,deploymentEnvironment:r,dataBucket:s,staticAssetsBucket:o,logsBucket:i}}function F(e){return typeof e=="string"&&e.trim().length>0}var Dt=F(I.env.NODE_ENV)?I.env.NODE_ENV.trim().toLowerCase():"development",Rt=!!I.env.AWS_LAMBDA_FUNCTION_NAME,Bt=!Rt&&(Dt==="development"||!F(I.env.NODE_ENV));if(Bt){let e=It.resolve(I.cwd(),".env");_t.existsSync(e)&&Ie.default.config({path:e})}var De=["S3_BUCKET","GEMINI_API_KEY"],$t=["CLOUDFRONT_ORIGINS"],le=De.filter(e=>!F(I.env[e]));$t.forEach(e=>{F(I.env[e])||console.warn(`Optional environment value ${e} is not set. Provide it via the runtime config file or environment to enable strict CORS.`)});!F(I.env.AWS_REGION)&&F(I.env.AWS_DEFAULT_REGION)&&(I.env.AWS_REGION=I.env.AWS_DEFAULT_REGION.trim());F(I.env.AWS_REGION)||le.push("AWS_REGION");if(le.length>0)throw new Error(`Missing required environment variables: ${le.join(", ")}. Ensure they are configured via deployment secrets or a local .env file.`);var{stageName:$n,deploymentEnvironment:Ln}=_e({propagateToProcessEnv:!0,propagateViteEnv:!1});var On=Object.freeze([...De,"AWS_REGION"]);import{PutObjectCommand as bn,S3Client as yn}from"@aws-sdk/client-s3";import j from"node:process";var se=null;function Re(e=[]){for(let t of e)if(typeof t=="string"){let n=t.trim();if(n)return n}return null}function Lt(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()}function Ot(){let e=[j.env.BUILD_TIMESTAMP,j.env.DEPLOY_TIMESTAMP];for(let t of e){let n=Lt(t);if(n)return n}return new Date().toISOString()}function jt(){if(se)return se;let e=Re([j.env.BUILD_VERSION,j.env.VERSION,j.env.npm_package_version]),t=Re([j.env.BUILD_SHA,j.env.GIT_COMMIT,j.env.GIT_SHA,j.env.GITHUB_SHA]),n=Ot();return se={version:e||null,sha:t||null,timestamp:n},se}function ue(e,{fallback:t="unknown"}={}){return typeof e=="string"&&e.trim()?e.trim():typeof e=="number"&&Number.isFinite(e)?String(e):t}function Be({versionLabel:e}={}){let{version:t,sha:n,timestamp:r}=jt(),s={"build-timestamp":ue(r,{fallback:new Date().toISOString()}),"build-version":ue(t||e),"build-sha":ue(n)};return typeof e=="string"&&e.trim()&&(s["asset-version-label"]=e.trim()),s}function zt(e={}){let t=Be(e),n=typeof t["build-sha"]=="string"?t["build-sha"].trim():"",r=typeof t["build-timestamp"]=="string"?t["build-timestamp"].trim():"",s=[];return n&&s.push({Key:"build",Value:n}),r&&s.push({Key:"deployed",Value:r}),s}function Kt(e,t=[]){let n=new URLSearchParams(e||"");for(let r of t){if(!r||typeof r.Key!="string")continue;let s=r.Key.trim();if(!s)continue;let o=typeof r.Value=="string"?r.Value.trim():"";o&&n.set(s,o)}return n.toString()}function $e(e={},t={}){let n=Be(t),r=e&&typeof e=="object"&&typeof e.Metadata=="object"&&e.Metadata!==null&&!Array.isArray(e.Metadata)?e.Metadata:{},s=Kt(e?.Tagging,zt(t)),o={...e,Metadata:{...r,...n}};return s&&(o.Tagging=s),o}function Le(e={}){if(!e||typeof e.body>"u"||e.body===null)return{};if(typeof e.body=="object")return e.body;try{let t=e.isBase64Encoded?Buffer.from(e.body,"base64").toString("utf8"):e.body;return JSON.parse(t)}catch{return{}}}var Pt=new Set("a,an,and,are,as,at,be,by,for,from,has,have,in,is,it,of,on,or,that,the,to,with,will,our,your,they,them,into,about,over,more,than,who,what,when,where,which,were,while,within,under,across,through,using,per".split(",").map(e=>e.trim())),oe=[{key:"layoutSearchability",category:"Layout & Searchability"},{key:"atsReadability",category:"Readability"},{key:"impact",category:"Impact"},{key:"crispness",category:"Crispness"},{key:"otherQuality",category:"Other"}],Vt={layoutSearchability:.2,atsReadability:.25,impact:.25,crispness:.15,otherQuality:.15};function Oe(e){return e>=85?"EXCELLENT":e>=70?"GOOD":"NEEDS_IMPROVEMENT"}function Y(e,t,n){return Math.min(Math.max(e,t),n)}function E(e){return Y(e,0,1)}function H(e=[],{limit:t=3,conjunction:n="and"}={}){if(!e.length)return"";let r=Array.from(new Set(e)).filter(Boolean);if(!r.length)return"";if(r.length===1)return r[0];if(r.length===2)return`${r[0]} ${n} ${r[1]}`;let s=r.slice(0,t),o=r.length-s.length;if(o>0)return`${s.join(", ")} and ${o} more`;let i=s.slice(0,-1).join(", "),a=s.slice(-1);return i?`${i} ${n} ${a}`:a.join("")}function U(e,t,n=[],r={}){let s=Y(t,0,100),o=Math.round(s),i=Oe(o),a=Array.from(new Set((n||[]).map(f=>typeof f=="string"?f.trim():"").filter(Boolean))),c=r&&typeof r=="object"?r.details:void 0;return a.length||(i==="EXCELLENT"?a.push(`Keep refining your ${e.toLowerCase()} as you add new achievements so the resume stays future-proof.`):a.push(`Focus on improving ${e.toLowerCase()} to raise this score\u2014tighten structure and mirror the job requirements.`)),{category:e,score:o,rating:i,ratingLabel:i,tips:a,...c?{details:c}:{}}}function Ft(e,{ideal:t=.4,tolerance:n=.25}={}){if(!isFinite(e)||e<=0)return 0;let r=Math.abs(e-t);return E(1-r/n)}function Ut(e,{idealMin:t=0,idealMax:n=1,tolerance:r=(n-t)/2}={}){if(!isFinite(e)||e<=0)return 0;if(e>=t&&e<=n)return 1;let s=e<t?t-e:e-n;return r<=0?0:E(1-s/r)}function Yt(e,t){if(!e||typeof e!="object")return U(t,0);let n=typeof e.score=="number"?Y(e.score,0,100):0,r=Math.round(n),s=Oe(r),o=Array.from(new Set([].concat(typeof e.tip=="string"?e.tip:[]).concat(Array.isArray(e.tips)?e.tips:[]).map(a=>typeof a=="string"?a.trim():"").filter(Boolean))),i=U(t,r,o).tips;return{...e,category:e.category||t,score:r,rating:s,ratingLabel:s,tips:o.length?o:i}}function W(e={}){return oe.reduce((t,{key:n,category:r})=>{let s=Yt(e[n],r);return{...t,[n]:s}},{})}function fe(e={}){let t=W(e),n=0,r=0;return oe.forEach(({key:s})=>{let o=Vt[s]??1,i=typeof t[s]?.score=="number"&&Number.isFinite(t[s].score)?Y(t[s].score,0,100):0;n+=i*o,r+=o}),r?Math.round(n/r):0}var je=["accelerated","achieved","built","delivered","developed","drove","enhanced","expanded","improved","increased","launched","led","optimized","reduced","scaled","spearheaded","streamlined"];function J(e=""){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function qt(e=""){if(!e)return"";let t=e.split(/\r?\n/),n=/^[A-Z][A-Z0-9\s/&-]{2,}$/,r=/^(summary|professional summary|profile|overview)$/i,s=!1,o=[];for(let i=0;i<t.length;i+=1){let c=t[i].trim();if(!s){c&&r.test(c)&&(s=!0);continue}if(!c){o.push("");continue}if(n.test(c)&&c===c.toUpperCase()||/^(experience|work experience|employment history|education|skills|projects|certifications|awards|accomplishments)$/i.test(c))break;o.push(c.replace(/\s+/g," "))}return o.join(" ").replace(/\s+/g," ").trim()}function Jt(e="",{jobText:t="",jobSkills:n=[],resumeSkills:r=[]}={}){let s=e.toLowerCase(),o=(t||"").toLowerCase(),i=e.split(/\r?\n/),a=i.map(d=>d.trim()).filter(Boolean),c=e.split(/\n\s*\n/).map(d=>d.trim()).filter(Boolean),f=c.filter(d=>/^[-•\u2022\u2023\u25e6\*]/.test(d)?!1:d.split(/\s+/).filter(Boolean).length>=70),l=a.filter(d=>/^[-•\u2022\u2023\u25e6\*]/.test(d)),u=a.filter(d=>d.length>42?!1:d.replace(/[^A-Za-z]/g,"").toUpperCase().length>=4&&d===d.toUpperCase()),h=new Set(u.map(d=>d.replace(/[^a-z]/gi,"").toLowerCase())),g=a.filter(d=>d.split(/\s{3,}/).length>=2),y=a.length?l.length/a.length:0,p=l.map(d=>d.replace(/^[-•\u2022\u2023\u25e6\*]\s*/,"").split(/\s+/).filter(Boolean).length),m=[],b=[];l.forEach((d,C)=>{let Z=p[C]||0;Z>28&&m.push(d),Z>0&&Z<8&&b.push(d)});let S=p.length?p.reduce((d,C)=>d+C,0)/p.length:0,L=l.filter(d=>/\b(responsible for|duties included|tasked with)\b/i.test(d)),v=l.filter(d=>je.some(C=>new RegExp(`\\b${J(C)}\\b`,"i").test(d))||/[+\d%$]/.test(d)),w=new Set((n||[]).map(d=>d.toLowerCase()).filter(Boolean)),R=new Set((r||[]).map(d=>d.toLowerCase()).filter(Boolean)),M=(o.match(/[a-z0-9+.#]+/g)||[]).filter(d=>d.length>=4&&!Pt.has(d)).slice(0,80),V=new Set([...w,...M]),G=Array.from(V),T=l.map(d=>{let C=G.filter(Z=>new RegExp(`\\b${J(Z)}\\b`,"i").test(d));return C.length?{line:d,matches:C}:null}).filter(Boolean),ie=T.map(d=>d.line),_=new Set(T.flatMap(d=>d.matches.map(C=>C.toLowerCase()))).size,He=T.reduce((d,C)=>d+C.matches.length,0),We=V.size?E(_/Math.max(4,V.size)):0,Ge=_?(He-_)/Math.max(1,_):0,Qe=E(Ge/4),Ze=G.filter(d=>new RegExp(`\\b${J(d)}\\b`,"i").test(e)),Q=qt(e),Xe=Q?G.filter(d=>new RegExp(`\\b${J(d)}\\b`,"i").test(Q)):[],et=Q?Array.from(w).filter(d=>new RegExp(`\\b${J(d)}\\b`,"i").test(Q)):[],ye=i.length,tt=Math.max(1,Math.ceil(ye/55)),nt=(e.match(/[\u2460-\u24ff\u2500-\u257f]/g)||[]).length,rt=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(e)||/\b\+?\d{1,3}[\s.-]?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}\b/.test(e),st=Array.from(h).some(d=>/summary|profile|overview/.test(d));return{text:e,normalizedResume:s,normalizedJobText:o,lines:a,bulletLines:l,headingLines:u,headingSet:h,multiColumnIndicators:g,bulletRatio:y,bulletWordCounts:p,avgBulletWords:S,fillerBullets:L,paragraphs:c,denseParagraphs:f,achievementLines:v,longBulletLines:m,shortBulletLines:b,normalizedJobSkills:w,normalizedResumeSkills:R,jobKeywordSet:V,bulletKeywordUniqueCount:_,bulletKeywordVariety:We,bulletKeywordHits:ie,keywordStuffingPenalty:Qe,jobKeywordMatches:Ze,summaryText:Q,summaryKeywordHits:Xe,summarySkillHits:et,nonAsciiCharacters:nt,hasContactInfo:rt,summaryPresent:st,rawLineCount:ye,estimatedPageCount:tt}}function Ht(e){let{headingLines:t,headingSet:n,bulletRatio:r,bulletLines:s,lines:o,hasContactInfo:i,denseParagraphs:a,estimatedPageCount:c,rawLineCount:f}=e,l=["experience","education","skills","summary"],u=l.filter(M=>Array.from(n).some(V=>V.includes(M))),h=E(t.length/6),g=E(u.length/l.length),y=s.length?Ft(r,{ideal:.42,tolerance:.28}):0,p=i?1:0,m=a.length?Math.min(.25,a.length*.08):0,b=c>2?Math.min(.3,(c-2)*.18):0,S=f>130?Math.min(.2,(f-130)*.003):0,L=100*E(h*.23+g*.24+y*.33+p*.14-m-b-S),v=l.filter(M=>!u.includes(M)).map(M=>M.charAt(0).toUpperCase()+M.slice(1)),w=[];v.length&&w.push(`Add clear section headers for ${H(v)} so ATS bots can index your resume (only ${t.length} heading${t.length===1?"":"s"} detected).`),s.length&&y<.55&&w.push(`Adjust your bullet usage\u2014${s.length} bullet${s.length===1?"":"s"} across ${o.length} lines makes scanning harder for recruiters.`),s.length||w.push("Break dense paragraphs into bullets so scanners can pick out wins."),i||w.push("Add contact details (email or phone) so hiring teams can reach you quickly."),a.length&&w.push(`Break up ${a.length} dense paragraph${a.length===1?"":"s"} with bullet points so resume scanners do not skip your achievements.`),c>2&&w.push(`Tighten the document to two pages\u2014ATS scoring drops once resumes stretch to ${c} pages.`),f>130&&c<=2&&w.push("Trim excess line spacing or sections so the resume stays within a quick-scan length."),w.length||w.push("Your structure is solid\u2014keep the consistent headings and bullet patterns to remain searchable.");let R={headingCount:t.length,headingDensity:Number((h*100).toFixed(1)),sectionCoverage:Number((g*100).toFixed(1)),bulletCount:s.length,bulletUsageScore:Number((y*100).toFixed(1)),contactInfoPresent:!!i,contactInfoScore:p?100:0,paragraphPenalty:Math.round(m*100),pagePenalty:Math.round(b*100),lengthPenalty:Math.round(S*100),estimatedPageCount:c,rawLineCount:f};return U("Layout & Searchability",L,w,{details:R})}function Wt(e){let{normalizedResume:t,text:n,multiColumnIndicators:r,nonAsciiCharacters:s}=e,o=[],i=/\btable\b/.test(t)&&/\|/.test(n),a=t.includes("table of contents"),c=/\bpage \d+ of \d+/i.test(n),f=/https?:\/\/\S+\.(png|jpg|jpeg|gif|svg)/i.test(n),l=/[{}<>]/.test(n),u={tableLikeFormatting:i?22:0,tableOfContents:a?18:0,pageNumberFooters:c?12:0,embeddedImages:f?16:0,multiColumnSpacing:r.length>0?Math.min(5+r.length*3,20):0,decorativeCharacters:l?8:0,nonAsciiCharacters:Math.min(s*1.5,18)},h=0;Object.entries(u).forEach(([m,b])=>{b>0&&(h+=b,m==="tableLikeFormatting"&&o.push("table-like formatting"),m==="tableOfContents"&&o.push("a table of contents"),m==="pageNumberFooters"&&o.push("page number footers"),m==="embeddedImages"&&o.push("embedded images"),m==="multiColumnSpacing"&&o.push("multi-column spacing that ATS bots misread"),m==="decorativeCharacters"&&o.push("decorative characters or HTML brackets"),m==="nonAsciiCharacters"&&s>0&&o.push("non-standard symbols that confuse parsers"))});let g=Y(100-h,0,100),y=[];o.length?y.push(`Remove ${H(o)}\u2014they frequently break ATS parsing engines.`):y.push("Formatting is ATS-safe\u2014keep the clean structure as you update content."),r.length>=6&&y.push("Switch to a single-column layout so ATS parsers read left-to-right cleanly."),s>10&&y.push("Replace decorative symbols with plain text\u2014ATS parsers misread special characters.");let p={baseScore:100,penaltyTotal:Math.round(Math.min(h,100)),penaltyBreakdown:Object.fromEntries(Object.entries(u).map(([m,b])=>[m,Number(b.toFixed(2))])),multiColumnIndicators:r.length,nonAsciiCharacters:s};return U("Readability",g,y,{details:p})}function Gt(e){let{achievementLines:t,bulletLines:n,bulletKeywordHits:r,bulletKeywordUniqueCount:s,bulletKeywordVariety:o,keywordStuffingPenalty:i,jobKeywordSet:a,summaryText:c,summaryKeywordHits:f,summarySkillHits:l,normalizedJobSkills:u,normalizedResumeSkills:h}=e,g=n.length,y=g?t.length/g:0,p=E(t.length/Math.max(3,g*.6)),m=n.length?r.length/n.length:0,b=o,S=1-Math.min(.6,i*.8),L=E((m*.6+b*.4)*S),v=!!c,w=v?E(l.length/Math.max(1,Math.min(u.size,6))):0,R=v?E((f.length+w*Math.min(a.size,6))/Math.max(2,Math.min(a.size,10))):0,M=a.size?a.size-(a.size-new Set(r).size):0,V=E(M/Math.max(4,a.size)),G=100*E(y*.45+L*.22+p*.23+Math.max(R,w)*.1),T=[];if(t.length?t.length<Math.max(3,Math.ceil(n.length*.4))?T.push(`Strengthen impact statements by pairing more bullets with numbers\u2014only ${t.length} of ${n.length||"your"} bullet${t.length===1?"":"s"} include metrics or performance verbs.`):T.push("Your bullets already show strong impact\u2014keep pairing metrics with outcome-driven verbs."):T.push("Add metrics or outcome verbs (e.g., increased, reduced) to your bullets\u2014none of the bullet points currently show quantified results."),a.size>0){if(b<.3)T.push("Vary the job-aligned language\u2014repeating one keyword will not boost impact as much as weaving in a mix tied to wins.");else if(r.length<Math.max(2,Math.ceil(a.size*.1))){let K=Array.from(a).slice(0,5).map(_=>_.charAt(0).toUpperCase()+_.slice(1));K.length&&T.push(`Mirror the job posting by weaving in keywords such as ${H(K)} inside your accomplishment bullets.`)}}if(v&&l.length===0&&u.size>0&&T.push("Rework your summary to echo critical job keywords so reviewers immediately see the alignment."),i>=.4&&!T.some(K=>/vary/.test(K))&&T.push("Avoid keyword stuffing\u2014anchor achievements with varied, role-relevant language instead of repeating the same term."),h.size&&u.size){let K=Array.from(u).filter(_=>!h.has(_));K.length&&T.push(`Explicitly list ${H(K.map(_=>_.charAt(0).toUpperCase()+_.slice(1)),{limit:5})} to mirror the job posting.`)}T.length||T.push("Impact storytelling is strong\u2014keep quantifying wins as you add new roles.");let ie={bulletCount:g,achievementBullets:t.length,achievementRatio:Number((y*100).toFixed(1)),achievementVolumeScore:Number((p*100).toFixed(1)),keywordLineRatio:Number((m*100).toFixed(1)),keywordVariety:Number((b*100).toFixed(1)),keywordQualityScore:Number((L*100).toFixed(1)),keywordStuffingPenalty:Number((i*100).toFixed(1)),summaryPresent:v,summaryKeywordScore:Number((R*100).toFixed(1)),summarySkillScore:Number((w*100).toFixed(1)),jobKeywordCount:a.size,bulletKeywordHits:r.length,bulletKeywordUniqueCount:s};return U("Impact",G,T,{details:ie})}function Qt(e){let{bulletLines:t,avgBulletWords:n,fillerBullets:r,longBulletLines:s,shortBulletLines:o}=e,i=t.filter(b=>je.some(S=>new RegExp(`^[-\u2022\u2022\u2023\u25E6*]?s*${J(S)}\b`,"i").test(b))),a=Ut(n,{idealMin:12,idealMax:22,tolerance:10}),c=t.length?r.length/t.length:1,f=E(1-c),l=t.length?i.length/t.length:0,u=t.length?s.length/t.length:0,h=t.length?o.length/t.length:0,g=E(1-Math.min(1,u*1.1+Math.max(0,h-.3))),y=100*E(a*.3+f*.25+l*.25+g*.2),p=[];t.length||p.push("Introduce concise bullet points (12\u201320 words) so recruiters can skim quickly."),n&&n<12&&p.push(`Expand key bullets beyond ${Math.round(n)} words to explain scope and outcomes without losing clarity.`),n>22&&p.push(`Tighten lengthy bullets\u2014your average is ${Math.round(n)} words, above the ATS-friendly 18\u201322 word sweet spot.`),s.length&&p.push(`Break overly long bullets (${s.length}) into two lines so each accomplishment pops.`),o.length>Math.ceil(t.length*.4)&&p.push("Add a bit more context to ultra-short bullets so they explain the impact."),r.length&&p.push(`Replace filler openers like "responsible for" with action verbs\u2014${r.length} bullet${r.length===1?"":"s"} use passive phrasing.`),p.length||p.push("Bullet length is crisp and skimmable\u2014maintain this balance while adding fresh wins as needed.");let m={bulletCount:t.length,averageBulletWords:Number(n.toFixed(2)),lengthScore:Number((a*100).toFixed(1)),fillerBulletRatio:Number((c*100).toFixed(1)),fillerScore:Number((f*100).toFixed(1)),verbStartRatio:Number((l*100).toFixed(1)),balanceScore:Number((g*100).toFixed(1)),longBullets:s.length,shortBullets:o.length};return U("Crispness",y,p,{details:m})}function Zt(e){let{normalizedJobSkills:t,normalizedResumeSkills:n,jobKeywordMatches:r,bulletKeywordVariety:s,bulletKeywordUniqueCount:o,keywordStuffingPenalty:i,summaryPresent:a,summaryKeywordHits:c,summarySkillHits:f}=e,l=t.size?n.size/Math.max(t.size,1):n.size>0?1:0,u=r.length?r.length/Math.max(t.size||r.length,6):n.size?Math.min(1,n.size/12):0,h=s;h<=0&&(h=r.length?E(r.length/Math.max(t.size||r.length,8)):0);let g=a?.2:0,y=t.size?.45:.25,p=t.size?.35:.5,m=a?E((c.length+f.length)/Math.max(2,t.size)):0,b=1-Math.min(.5,i*.7),S=E((u*.6+h*.4)*b),L=100*E(l*y+S*p+m*g),v=[];if(n.size||v.push("Add a dedicated skills section so ATS parsers can map your proficiencies."),t.size&&n.size){let R=Array.from(t).filter(M=>!n.has(M));R.length&&v.push(`Incorporate keywords such as ${H(R)} to mirror the job description.`)}a&&!c.length&&t.size&&v.push(`Infuse your summary or headline with domain language from the posting\u2014for example ${H(Array.from(t).slice(0,3))}\u2014to reinforce alignment.`),i>=.4?v.push("Swap repeated keywords for specific accomplishments\u2014ATS now favors varied, evidence-backed language."):h<.3&&r.length&&v.push("Broaden the range of JD-aligned keywords instead of repeating the same few terms."),v.length||v.push("Keyword coverage is solid\u2014keep tailoring skills to each job description.");let w={normalizedJobSkillCount:t.size,normalizedResumeSkillCount:n.size,jobKeywordMatches:r.length,skillCoverage:Number((l*100).toFixed(1)),keywordCoverageScore:Number((u*100).toFixed(1)),keywordVariety:Number((h*100).toFixed(1)),keywordQualityComposite:Number((S*100).toFixed(1)),keywordStuffingPenalty:Number((i*100).toFixed(1)),summaryContribution:Number((m*100).toFixed(1)),weights:{skillWeight:Number((y*100).toFixed(1)),keywordWeight:Number((p*100).toFixed(1)),summaryWeight:Number((g*100).toFixed(1))},summaryPresent:a,bulletKeywordUniqueCount:o};return U("Other",L,v,{details:w})}function de(e="",{jobText:t="",jobSkills:n=[],resumeSkills:r=[]}={}){if(!e?.trim())return W();let s=Jt(e,{jobText:t,jobSkills:n,resumeSkills:r}),o=Ht(s),i=Wt(s),a=Gt(s),c=Qt(s),f=Zt(s);return W({layoutSearchability:o,atsReadability:i,impact:a,crispness:c,otherQuality:f})}var Xt=["javascript","typescript","python","java","c++","c#","go","ruby","php","swift","kotlin","react","angular","vue","node","express","next.js","docker","kubernetes","aws","gcp","azure","sql","mysql","postgresql","mongodb","git","graphql","linux","bash","redis","jenkins","terraform","ansible"],en=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function me(e=""){let t=e.toLowerCase(),n=[];for(let r of Xt)new RegExp(`\\b${en(r)}\\b`,"g").test(t)&&n.push(r);return n}function he(e=[],t=[]){let n=e.map(i=>{let a=t.some(c=>c.toLowerCase()===i.toLowerCase());return{skill:i,matched:a}}),r=n.filter(i=>i.matched).length,s=e.length?Math.round(r/e.length*100):0,o=n.filter(i=>!i.matched).map(i=>i.skill);return{score:s,table:n,newSkills:o}}function ze(e){let t=[],n=o=>{if(o!=null){if(Array.isArray(o)){o.forEach(i=>n(i));return}if(typeof o=="object"){Object.values(o).forEach(i=>n(i));return}typeof o=="string"&&o.split(/[\n,]/).map(i=>i.trim()).filter(Boolean).forEach(i=>t.push(i))}};n(e);let r=new Set,s=[];for(let o of t){let i=o.toLowerCase();r.has(i)||(r.add(i),s.push(o))}return s}function A(e){return typeof e!="number"||Number.isNaN(e)?0:Y(e,0,100)}var pe=[{key:"designation",label:"Designation match"},{key:"experience",label:"Years / experience"},{key:"skills",label:"Skill match"},{key:"tasks",label:"Task overlap"},{key:"highlights",label:"Highlights"},{key:"certifications",label:"Certifications"}],te=8,ge=97;function D(e){return typeof e=="string"?e:""}function be(e){return D(e).replace(/\r\n/g,`
`)}function q(e){return typeof e!="number"||Number.isNaN(e)?0:Math.round(e)}function Ke(e){switch(e){case"match":return"a strong match";case"gap":return"a gap";case"partial":return"a partial match";case"info":return"informational coverage";default:return"an unknown status"}}function tn(e){switch(e){case"match":return"positive";case"gap":return"negative";case"partial":return"warning";default:return"info"}}function nn(e=""){let t=be(e).split(/\n/).map(r=>r.trim()).filter(Boolean);return t.length&&(t.slice(0,4).find(r=>{if(!r||r.length>80||/[.:!?]/.test(r))return!1;let o=r.split(/\s+/).filter(Boolean);return o.length===1?!1:o.filter(a=>/[A-Z]/.test(a.charAt(0))).length>=Math.max(2,Math.floor(o.length/2))})||t[0])||""}function Pe(e=""){return D(e).toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim()}function rn({resumeText:e,jobTitle:t}){let n=nn(e),r=Pe(n),s=Pe(t),o="unknown",i=60,a="Headline alignment could not be determined.";if(s&&r)if(r.includes(s)||s.includes(r))o="match",i=92,a="Headline mirrors the job designation.";else{let c=new Set(s.split(" ").filter(Boolean)),f=new Set(r.split(" ").filter(Boolean)),l=Array.from(c).filter(u=>f.has(u));l.length>=Math.max(1,Math.floor(c.size/2))?(o="partial",i=78,a=`Headline overlaps with the JD designation (${l.join(", ")}).`):(o="gap",i=58,a=`Headline (\u201C${n||"\u2014"}\u201D) differs from the JD designation.`)}else s?(o="partial",i=70,a="Provide a headline so we can confirm designation alignment."):r&&(o="info",i=72,a="Job title unavailable. Keep headline focused on the target role.");return{key:"designation",label:"Designation match",score:A(i),status:o,detail:a,headline:n}}function Ve(e){let t=String(e||"").trim();if(!/^\d{4}$/.test(t))return null;let n=Number(t);return Number.isFinite(n)?n:null}function sn(e=""){let t=be(e).toLowerCase();if(!t)return 0;let n=[],r=/(19|20)\d{2}\s*(?:-|–|to)\s*(?:present|current|(19|20)\d{2})/gi,s;for(;(s=r.exec(t))!==null;){let u=Ve(s[0].slice(0,4)),g=s[0].slice(s[0].lastIndexOf(" ")+1).replace(/[^0-9a-z]/gi,"").toLowerCase(),y=new Date().getUTCFullYear(),p=g==="present"||g==="current"?y:Ve(g);u&&p&&p>=u&&n.push([u,p])}let o=[];n.sort((u,h)=>u[0]-h[0]).forEach(([u,h])=>{if(!o.length){o.push([u,h]);return}let g=o[o.length-1];u<=g[1]?g[1]=Math.max(g[1],h):o.push([u,h])});let i=0;o.forEach(([u,h])=>{i+=Math.max(0,h-u+1)});let a=/(\d{1,2})\s*\+?\s*(years|yrs)/gi,c=0,f;for(;(f=a.exec(t))!==null;){let u=Number(f[1]);Number.isFinite(u)&&(c=Math.max(c,u))}let l=Math.max(i,c);return Math.min(45,Math.round(l*10)/10)}function on(e=""){let t=D(e);if(!t)return null;let n=/(?:at\s+least|minimum(?:\s+of)?|min\.?|require(?:s|d)?|with)?\s*(\d+)(?:\s*[-–to]{1,3}\s*(\d+))?\s*(\+|plus)?\s*(?:years|yrs)/gi,r=null,s=null,o;for(;(o=n.exec(t))!==null;){let i=Number(o[1]),a=o[2]?Number(o[2]):null,c=!!o[3];if(!Number.isFinite(i))continue;let f=i,l=a;l!==null&&l<f&&([l,f]=[f,l]),c&&(l=null),(r===null||f>r)&&(r=f),l===null?s=null:s!==null?s=Math.max(s,l):s=l}return r===null?null:{minYears:r,maxYears:s}}function an({resumeText:e,jobDescription:t}){let n=sn(e),r=on(t),s="unknown",o=n>0?`Resume indicates roughly ${n} years of experience.`:"Experience duration not detected\u2014add clear timelines for each role.",i=n>0?68:52;if(r){let{minYears:a,maxYears:c}=r;n<=0?(s="gap",i=42,o=`The JD requests ${a}+ years. Add role dates to show your tenure.`):n>=a?(s="match",i=92,o=`Resume reflects ~${n} years, meeting the ${a}+ year requirement.`,c&&n>c+2&&(s="info",i=80,o+=` Frame senior projects so they align with the ${c}-year focus.`)):a-n<=1?(s="partial",i=74,o=`Within about ${Math.round((a-n)*10)/10} years of the ${a}+ requirement\u2014surface longer engagements.`):(s="gap",i=50,o=`Resume shows about ${n} years. Highlight earlier roles to close the ${a}+ year gap.`)}else n>0&&(s="info",i=76,o=`JD does not specify tenure. Resume signals ~${n} years of experience.`);return{key:"experience",label:"Years / experience",score:A(i),status:s,detail:o,candidateYears:n,requiredYears:r?.minYears??null,maximumYears:r?.maxYears??null}}function cn({matchScore:e,missingSkills:t,addedSkills:n}){let r=Array.isArray(t)?t.filter(Boolean):[],s=Array.isArray(n)?n.filter(Boolean):[],o=A(e),i="match",a=`Resume covers ${o}% of the JD skills.`;return o<70?(i=r.length?"gap":"partial",a=r.length>0?`Still missing ${r.slice(0,4).join(", ")} from the JD.`:`Resume covers ${o}% of the JD skills\u2014reinforce keywords throughout the experience section.`):s.length&&(a=`Now covers ${o}% of JD skills, adding ${s.slice(0,4).join(", ")}.`),{key:"skills",label:"Skill match",score:o,status:i,detail:a,missing:r,added:s}}function ln({atsBreakdown:e}){let t=Number(e?.impact?.score)||0,n="unknown",r="Task alignment insights were unavailable.";return t>=80?(n="match",r="Achievement bullets mirror JD responsibilities."):t>=55?(n="partial",r="Some bullets align with the JD\u2014add measurable outcomes for task ownership."):(n="gap",r="Rework bullets to highlight JD-specific tasks and quantifiable results."),{key:"tasks",label:"Task overlap",score:A(t>=80?Math.max(t,82):t>=55?Math.max(t,68):Math.max(t,45)),status:n,detail:r,rawImpactScore:t}}function un({atsBreakdown:e}){let t=Number(e?.crispness?.score)||0,n=Number(e?.otherQuality?.score)||0,r=A(Math.round((t+n)/2)),s="info",o="Highlights are generally clear and skimmable.";return r>=80?(s="match",o="Highlights are crisp with measurable outcomes."):r<55&&(s="gap",o="Tighten bullets and emphasise impact to sharpen highlights."),{key:"highlights",label:"Highlights",score:r,status:s,detail:o}}function fn({resumeText:e,jobDescription:t}){let n=be(e).toLowerCase(),r=D(t).toLowerCase(),s=/certifications?|licenses?/i.test(e)||/certified|credential|license/i.test(e),o=/certification|certified|license|credential/.test(r),i="info",a=s?82:70,c=s?"Resume lists certifications.":"No dedicated certifications section detected.";return o&&s?(i="match",a=90,c="Resume highlights certifications requested in the JD."):o&&!s?(i="gap",a=56,c="JD references certifications\u2014add a certifications section or cite credentials in experience bullets."):!o&&s&&(i="info",a=84,c="Certifications listed\u2014ensure they stay relevant to the role."),{key:"certifications",label:"Certifications",score:A(a),status:i,detail:c,jobRequestsCerts:o,resumeHasCerts:s}}function Fe({resumeText:e,jobTitle:t,jobDescription:n,matchScore:r,missingSkills:s,addedSkills:o,atsBreakdown:i}){let a={designation:rn({resumeText:e,jobTitle:t}),experience:an({resumeText:e,jobDescription:n}),skills:cn({matchScore:r,missingSkills:s,addedSkills:o}),tasks:ln({atsBreakdown:i}),highlights:un({atsBreakdown:i}),certifications:fn({resumeText:e,jobDescription:n})},c=pe.map(({key:m})=>{let b=a[m]?.score;return typeof b=="number"&&Number.isFinite(b)?A(b):null}).filter(m=>m!==null),f=c.length?Math.round(c.reduce((m,b)=>m+b,0)/c.length):0,l=A(f),u=null;c.length?l<te?(l=te,u=`Probability lifted to ${te}% to reflect baseline interview chances.`):l>ge&&(l=ge,u=`Probability capped at ${ge}% to avoid overstating selection odds.`):(l=te,u=`Insufficient signals detected, defaulting to ${te}% selection probability.`);let h=l>=75?"High":l>=55?"Medium":"Low",g=[];Object.values(a).forEach(m=>{!m||!m.status||(m.status==="gap"?g.push(m.detail||`${m.label} needs attention.`):m.status==="match"&&g.push(m.detail||`${m.label} aligns with the JD.`))}),u&&g.push(u);let y=`Projected ${h.toLowerCase()} probability (${l}%) that this resume will be shortlisted for the JD`,p=g.length?`${y} because ${g.join("; ")}.`:`${y}.`;return{metrics:a,probability:l,level:h,summary:p}}function dn(e={},t={}){let n={};return pe.forEach(({key:r,label:s})=>{let o=A(e[r]?.score??0),i=A(t[r]?.score??0);n[r]={key:r,label:s,score:q(i-o),statusChange:e[r]?.status!==t[r]?.status?t[r]?.status:null}}),n}function mn(e={},t={}){return pe.map(({key:n,label:r})=>{let s=e[n]||{},o=t[n]||{},i=o.status||s.status||"info",a=tn(i),c=s.score,f=o.score,l=typeof c=="number"&&Number.isFinite(c),u=typeof f=="number"&&Number.isFinite(f),h=l?A(c):null,g=u?A(f):null,y=l&&u?q(g-h):null,p=s.status&&o.status&&s.status!==o.status?`Status moved from ${Ke(s.status)} to ${Ke(o.status)}.`:"",b=D(o.detail).trim()||D(s.detail).trim();b||(i==="gap"?b=`${r} needs improvement to align with the JD.`:i==="match"?b=`${r} aligns with the JD expectations.`:i==="partial"?b=`${r} is partially aligned\u2014add more role-specific examples.`:b=`${r} provides informational signals for selection scoring.`),p&&(b=`${p} ${b}`.trim());let S={key:n,label:r,impact:a,status:i,detail:b};return h!==null&&(S.scoreBefore=h),g!==null&&(S.scoreAfter=g),y!==null&&(S.scoreDelta=y),S})}function hn(e={},t={}){let n={};return oe.forEach(({key:r,category:s})=>{let o=A(e[r]?.score??0),i=A(t[r]?.score??0);n[r]={key:r,category:s,score:q(i-o)}}),n}function gn(e){return D(e).replace(/[^a-z0-9\-]+/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,96)}function pn(e=[],t=[]){let n=new Set((e||[]).filter(s=>s?.matched).map(s=>(s?.skill||"").toLowerCase()).filter(Boolean)),r=(t||[]).filter(s=>s?.matched).map(s=>s?.skill||"").filter(Boolean).filter(s=>!n.has(s.toLowerCase()));return Array.from(new Set(r))}function Ue(e={}){let t=D(e.jobId).trim();if(!t)return{ok:!1,error:{statusCode:400,code:"JOB_ID_REQUIRED",message:"jobId is required to score the resume against the job description."}};let n=D(e.resumeText);if(!n.trim())return{ok:!1,error:{statusCode:400,code:"RESUME_TEXT_REQUIRED",message:"resumeText is required to score the resume against the job description."}};let r=D(e.enhancedResumeText)||n,s=D(e.jobDescription||e.jobDescriptionText),o=ze(e.jobSkills);if(!o.length)return{ok:!1,error:{statusCode:400,code:"JOB_SKILLS_REQUIRED",message:"Provide jobSkills with at least one keyword to calculate a score."}};let i=D(e.jobTitle||e.designation||""),a=gn(e.sessionId||e.sessionSegment||""),c=me(n),f=me(r),l=he(o,c),u=he(o,f),h=W(de(n,{jobText:s,jobSkills:o,resumeSkills:c})),g=W(de(r,{jobText:s,jobSkills:o,resumeSkills:f})),y=fe(h),p=fe(g),m=Fe({resumeText:n,jobTitle:i,jobDescription:s,matchScore:l.score,missingSkills:l.newSkills,addedSkills:[],atsBreakdown:h}),b=pn(l.table,u.table),S=Fe({resumeText:r,jobTitle:i,jobDescription:s,matchScore:u.score,missingSkills:u.newSkills,addedSkills:b,atsBreakdown:g}),L=dn(m.metrics,S.metrics),v=mn(m.metrics,S.metrics),w=hn(h,g),R=Array.isArray(u.table)?u.table:[];return{ok:!0,result:{success:!0,jobId:t,sessionId:a||null,score:u.score,missingSkills:u.newSkills,alignmentTable:R,match:{before:{score:l.score,missingSkills:l.newSkills,table:l.table},after:{score:u.score,missingSkills:u.newSkills,table:u.table},delta:{score:q(u.score-l.score),coveredSkills:b}},ats:{before:{score:y,breakdown:h},after:{score:p,breakdown:g},delta:{score:q(p-y),breakdown:w}},selection:{before:{probability:m.probability,level:m.level,summary:m.summary,metrics:m.metrics},after:{probability:S.probability,level:S.level,summary:S.summary,metrics:S.metrics},delta:{probability:q(S.probability-m.probability),levelChange:m.level&&S.level&&m.level!==S.level?S.level:null,metrics:L},factors:v},selectionProbabilityBefore:m.probability,selectionProbabilityAfter:S.probability,selectionProbabilityDelta:q(S.probability-m.probability),selectionProbabilityFactors:v}}}function Ye(e){if(!e||typeof e!="object")return{statusCode:500,headers:{"Content-Type":"application/json"},body:JSON.stringify({success:!1,code:"INTERNAL_ERROR",message:"Unable to score the resume."})};if(!e.ok){let{statusCode:t,code:n,message:r,details:s}=e.error||{};return{statusCode:t||400,headers:{"Content-Type":"application/json"},body:JSON.stringify({success:!1,code:n||"VALIDATION_ERROR",message:r||"Unable to score the resume against the job description.",...s!==void 0?{details:s}:{}})}}return{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify(e.result)}}function Sn(){return new yn({region:process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||"us-east-1"})}var wn=Sn();function $(e,{fallback:t="",maxLength:n=96}={}){if(typeof e=="number")return $(String(e),{fallback:t,maxLength:n});if(typeof e!="string"){let o=typeof t=="string"?t:typeof t=="number"?String(t):"";return o?$(o,{fallback:"",maxLength:n}):""}let r=e.trim();if(!r){let o=typeof t=="string"?t.trim():typeof t=="number"?String(t):"";return o?$(o,{fallback:"",maxLength:n}):""}let s=r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"").slice(0,n);return s||(t?$(t,{fallback:"",maxLength:n}):"")}function z(e=""){return e?e.endsWith("/")?e:`${e}/`:""}function qe(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";let n=t.replace(/[^/]+$/,""),r=z(n).split("/").filter(Boolean);if(r.length<3)return"";let s=r[2];return!s||/^\d{4}-\d{2}-\d{2}$/.test(s)||s==="incoming"?"":`${r.slice(0,3).join("/")}/`}function vn({ownerSegment:e,dateSegment:t,jobSegment:n,sessionSegment:r}={}){let s=$(e,{fallback:"candidate"})||"candidate",o=$(r),i=$(t),a=$(n),c=["cv",s];return o?c.push(o):(i&&c.push(i),a&&c.push(a)),`${c.join("/")}/`}function En(e){if(typeof e!="string")return"";let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");return t?t.slice(0,48):""}function xn({payload:e={},result:t={}}={}){let n=e&&typeof e.sessionPointer=="object"&&e.sessionPointer?e.sessionPointer:{},r=typeof n.prefix=="string"&&n.prefix.trim()?n.prefix.trim():"",s=typeof n.changeLogKey=="string"&&n.changeLogKey.trim()?n.changeLogKey.trim():"",o=typeof e.sessionChangeLogKey=="string"&&e.sessionChangeLogKey.trim()?e.sessionChangeLogKey.trim():"",i=s||o,a=r?z(r):"";if(!a&&i&&(a=qe(i)),!a){let f=typeof e.sessionPrefix=="string"&&e.sessionPrefix.trim()?e.sessionPrefix.trim():"";f&&(a=z(f))}if(!a){let f=typeof e.originalUploadKey=="string"&&e.originalUploadKey.trim()?e.originalUploadKey.trim():"";f&&(a=qe(f))}return{sessionPrefix:a?z(a):"",changeLogKey:i}}function Tn({payload:e={},result:t={}}={}){let n=new Date().toISOString().replace(/[:.]/g,"-"),{sessionPrefix:r,changeLogKey:s}=xn({payload:e,result:t});if(r)return{key:`${z(r)}logs/scoring/${n}.json`,context:{sessionPrefix:z(r),...s?{changeLogKey:s}:{}}};let o=e&&typeof e.sessionPointer=="object"&&e.sessionPointer?e.sessionPointer:{},i=$(e.ownerSegment??o.ownerSegment??e.userId??o.userId??"")||"candidate",a=$(t.sessionId??e.sessionId??e.sessionSegment??o.sessionId??o.sessionSegment??""),c=$(e.dateSegment??o.dateSegment??""),f=En(t.jobId??e.jobId??o.jobId??""),l=vn({ownerSegment:i,sessionSegment:a,dateSegment:c,jobSegment:f});return{key:`${z(l)}logs/scoring/${n}.json`,context:{sessionPrefix:z(l)}}}async function kn({payload:e,result:t}){let n=typeof process.env.S3_BUCKET=="string"?process.env.S3_BUCKET.trim():"";if(!n)throw new Error("S3_BUCKET environment variable is required to store scoring audits.");let{key:r,context:s}=Tn({payload:e,result:t}),o={};s?.sessionPrefix&&(o.sessionPrefix=z(s.sessionPrefix)),s?.changeLogKey&&(o.changeLogKey=s.changeLogKey);let i=JSON.stringify({jobId:t.jobId,sessionId:t.sessionId||e.sessionId||e.sessionSegment||null,createdAt:new Date().toISOString(),...Object.keys(o).length?{context:o}:{},result:t},null,2);return await wn.send(new bn($e({Bucket:n,Key:r,Body:i,ContentType:"application/json"}))),{bucket:n,key:r,...Object.keys(o).length?{context:o}:{}}}async function Je(e,t){let n=Le(e),r=Ue(n);if(r.ok)try{let s=await kn({payload:n,result:r.result});r.result.audit=s}catch(s){r.result.audit={error:{message:s?.message||"Unable to persist scoring audit to S3."}}}return Ye(r)}export{Je as default,Je as handler};
